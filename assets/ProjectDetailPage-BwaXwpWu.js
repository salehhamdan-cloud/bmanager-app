import{r as i,h as ce,i as R,S as ee,j as e,k as Se,u as Ce,l as Pe,b as te,m as ke,n as De,o as se,a as ae,p as Ae,L as Fe,C as Te,q as Re,D as Oe,s as Ee,U as Ue,I as Me,t as $e,R as Le,F as Be,Q as We,v as Ge,W as He,M as re,w as ze,e as W,x as oe,y as _e,z as q}from"./index-D-cHbBwn.js";import{a as ne}from"./dateFormatter-CUKId3Gl.js";import{I as qe}from"./ImageUploader-QK9p397g.js";import{c as le,a as Ve}from"./pdfUtils-CkvU2BMR.js";import{C as J,r as Qe}from"./chart-Zj-L_LRF.js";import{N as C}from"./NavigationCard-5VvEbhy9.js";import{A as Je}from"./AddFileModal-Dsl0kVwl.js";import{A as Ye}from"./AddTodoModal-CQJ0H9NW.js";import{S as ie,g as Ke,a as Xe}from"./aiService-BGt51fXt.js";import{t as Ze}from"./emailService-Ce1ZuM1T.js";import"./imageService-DERf2zoE.js";import"./AnnotationEditor-CCeRCJQ5.js";import"./shareUtils-BhFQGnPw.js";import"./pdfService-D-0A9fw7.js";import"./RecurrenceEditor-rLx-RXEn.js";J.register(...Qe);const et=({project:c,problems:s})=>{const $=i.useRef(null),L=i.useRef(null),{settings:G}=ce(),d=i.useMemo(()=>{const m=s.filter(o=>!o.isFixed),b={[R.LOW]:0,[R.MEDIUM]:0,[R.HIGH]:0,[R.CRITICAL]:0};m.forEach(o=>{b[o.severity]=(b[o.severity]||0)+1});const h=new Date;h.setHours(0,0,0,0);const y=new Date;y.setDate(h.getDate()+(G.notificationDays||7));const P=(c.files||[]).filter(o=>o.dueDate&&new Date(o.dueDate)<h).length,O=(c.files||[]).filter(o=>{if(!o.dueDate)return!1;const v=new Date(o.dueDate);return v>=h&&v<=y}).length,V=(c.todos||[]).filter(o=>!o.isCompleted&&o.dueDate&&new Date(o.dueDate)<h).length,E=(c.todos||[]).filter(o=>{if(o.isCompleted||!o.dueDate)return!1;const v=new Date(o.dueDate);return v>=h&&v<=y}).length;let u=0,U=0;(c.workers||[]).forEach(o=>{[o.safetyPermit,o.workAtHeightPermit,...o.licenses.map(k=>k.file)].forEach(k=>{if(k?.validUntil){const A=new Date(k.validUntil);A<h?u++:A<=y&&U++}})});let p=0,B=0;return(c.inventory||[]).forEach(o=>o.itemGroups.forEach(v=>v.items.forEach(k=>{if(k.warrantyEndDate){const A=new Date(k.warrantyEndDate);A<h?p++:A<=y&&B++}}))),{totalProblems:s.length,openProblems:m.length,fixedProblems:s.length-m.length,openCritical:b[R.CRITICAL],severityCounts:b,expiredFiles:P,expiredTodos:V,dueSoonFiles:O,dueSoonTodos:E,expiredPermits:u,dueSoonPermits:U,expiredWarranties:p,dueSoonWarranties:B}},[s,c,G.notificationDays]),H=i.useMemo(()=>{const m=Object.values(R),b=m.map(P=>d.severityCounts[P]),h=m.map(P=>ee[P]?.pdfFill||"#cccccc"),y=m.map(P=>ee[P]?.pdfText||"#666666");return{labels:m,datasets:[{label:"Open Problems by Severity",data:b,backgroundColor:h,borderColor:y,borderWidth:1}]}},[d.severityCounts]),z=i.useMemo(()=>{const m=["טופלו","פתוחות"],b=[d.fixedProblems,d.openProblems];return{labels:m,datasets:[{label:"Problems by Status",data:b,backgroundColor:["#22c55e","#f59e0b"],borderColor:"#ffffff",borderWidth:2}]}},[d.fixedProblems,d.openProblems]);i.useEffect(()=>{let m=null;return $.current&&(m=new J($.current,{type:"doughnut",data:H,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{font:{family:"Heebo"}}},title:{display:!0,text:"תקלות פתוחות לפי חומרה",font:{family:"Heebo",size:14}}}}})),()=>m?.destroy()},[H]),i.useEffect(()=>{let m=null;return L.current&&(m=new J(L.current,{type:"pie",data:z,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{font:{family:"Heebo"}}},title:{display:!0,text:"סטטוס תקלות כללי",font:{family:"Heebo",size:14}}}}})),()=>m?.destroy()},[z]);const j=({title:m,value:b,colorClass:h})=>e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm text-center border",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-800",children:b}),e.jsx("p",{className:`text-xs font-medium ${h}`,children:m})]});return e.jsxs("section",{className:"mb-6 p-4 bg-slate-50 rounded-lg shadow-inner border border-slate-200",children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-700 mb-4",children:"סיכום בניין"}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-4",children:[e.jsx(j,{title:"סה״כ תקלות",value:d.totalProblems,colorClass:"text-slate-500"}),e.jsx(j,{title:"תקלות פתוחות",value:d.openProblems,colorClass:"text-amber-500"}),e.jsx(j,{title:"תקלות קריטיות פתוחות",value:d.openCritical,colorClass:"text-red-500"}),e.jsx(j,{title:"תקלות שטופלו",value:d.fixedProblems,colorClass:"text-green-500"}),e.jsx(j,{title:"קבצים שפג תוקפם",value:d.expiredFiles,colorClass:"text-orange-500"}),e.jsx(j,{title:"משימות שפג תוקפן",value:d.expiredTodos,colorClass:"text-orange-500"}),e.jsx(j,{title:"היתרים שפג תוקפם",value:d.expiredPermits,colorClass:"text-orange-500"}),e.jsx(j,{title:"אחריות שפג תוקפה",value:d.expiredWarranties,colorClass:"text-orange-500"}),e.jsx(j,{title:"קבצים לקראת תפוגה",value:d.dueSoonFiles,colorClass:"text-purple-500"}),e.jsx(j,{title:"משימות לקראת תפוגה",value:d.dueSoonTodos,colorClass:"text-purple-500"}),e.jsx(j,{title:"היתרים לקראת תפוגה",value:d.dueSoonPermits,colorClass:"text-purple-500"}),e.jsx(j,{title:"אחריות לקראת תפוגה",value:d.dueSoonWarranties,colorClass:"text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-lg shadow-sm border",children:e.jsx("div",{className:"relative h-60",children:d.openProblems>0?e.jsx("canvas",{ref:$}):e.jsx("p",{className:"text-center text-slate-400 pt-24",children:"אין תקלות פתוחות."})})}),e.jsx("div",{className:"bg-white p-2 rounded-lg shadow-sm border",children:e.jsx("div",{className:"relative h-60",children:d.totalProblems>0?e.jsx("canvas",{ref:L}):e.jsx("p",{className:"text-center text-slate-400 pt-24",children:"אין תקלות."})})})]})]})},tt=c=>c?c.split(" ").map(s=>s[0]).slice(0,2).join("").toUpperCase():"",jt=()=>{const{projectId:c}=Se(),[s,$]=i.useState(null),[L,G]=i.useState([]),[d,H]=i.useState([]),[z,j]=i.useState([]),[m,b]=i.useState([]),[h,y]=i.useState(!0),[P,O]=i.useState(!1),[V,E]=i.useState(!1),[u,U]=i.useState({}),[p,B]=i.useState({title:"",description:"",group:"",date:new Date().toISOString().split("T")[0],workerIds:[],supplierIds:[],tenantIds:[]}),[o,v]=i.useState(!1),[k,A]=i.useState(!1),{addToast:n}=Ce(),{settings:de}=ce(),[me,_]=i.useState(!1),Y=i.useRef(null),K=i.useRef(null),F=i.useCallback(async()=>{if(c){y(!0);try{const t=await Pe(c);if(t){$(t);const[r,a,D]=await Promise.all([te(c),ke(c),De()]);G(r.sort((l,f)=>new Date(f.date).getTime()-new Date(l.date).getTime())),j(a),b(D);const w=r.map(l=>se(l.id)),g=await Promise.all(w);H(g.flat())}else n("בניין לא נמצא","error")}catch(t){console.error("Error fetching project details:",t),n("שגיאה בטעינת פרטי הבניין","error")}finally{y(!1)}}},[c,n]);i.useEffect(()=>{F()},[F]);const x=(t,r)=>{const{name:a,value:D,type:w}=t.target,g=r==="newReport"?B:U;if(t.target.multiple){const l=Array.from(t.target.selectedOptions,f=>f.value);g(f=>({...f,[a]:l}))}else g(w==="number"?l=>({...l,[a]:D===""?void 0:parseFloat(D)}):l=>({...l,[a]:D}))},pe=t=>{const r=t.map(a=>({id:a.id,dataUrl:a.dataUrl,url:a.url,storagePath:a.storagePath,name:a.name,mimeType:a.mimeType,uploadedAt:a.createdAt}));U(a=>({...a,images:r}))},ue=async t=>{if(t.preventDefault(),!p.title||!c){n("כותרת הדוח היא שדה חובה","warning");return}const r={id:W(),projectId:c,title:p.title,date:p.date?new Date(p.date).toISOString():new Date().toISOString(),description:p.description||"",group:p.group?.trim()||void 0,workerIds:p.workerIds||[],supplierIds:p.supplierIds||[],tenantIds:p.tenantIds||[],files:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{await oe(r),n("דוח חדש נוסף בהצלחה","success"),s&&Ze(r,s,de),O(!1),B({title:"",description:"",group:"",date:new Date().toISOString().split("T")[0],workerIds:[],supplierIds:[],tenantIds:[]}),F()}catch(a){console.error("Error adding report:",a),n("שגיאה בהוספת הדוח","error")}},xe=async t=>{if(t.preventDefault(),!u.name||!s){n("שם הבניין הוא שדה חובה","warning");return}const r={...s,...u,name:u.name,images:u.images||s.images,updatedAt:new Date().toISOString()};try{await q(r),n("פרטי הבניין עודכנו","success"),E(!1),F()}catch(a){console.error("Error updating project:",a),n("שגיאה בעדכון הבניין","error")}},he=async()=>{if(!(!s||!c)){n("מכין קובץ גיבוי...","info");try{const t=await te(c),r=[],a=[];for(const I of t){const S=await se(I.id);r.push(...S);const T=await ze(I.id);a.push(...T)}const w=JSON.stringify({project:s,reports:t,problems:r,forms:a},null,2),g=new Blob([w],{type:"application/json"}),l=URL.createObjectURL(g),f=document.createElement("a");f.href=l;const N=new Date().toISOString().split("T")[0];f.download=`${s.name.replace(/[^a-z0-9\u0590-\u05FF]/gi,"_")}_backup_${N}.json`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(l),n("הבניין יוצא בהצלחה","success")}catch(t){console.error("Error exporting project:",t),n("שגיאה בייצוא הבניין","error")}}},ge=async t=>{if(!s)return;const r={...s,files:[...s.files||[],...t],updatedAt:new Date().toISOString()};try{await q(r),n(`${t.length} ${t.length>1?"קבצים נוספו":"קובץ נוסף"} בהצלחה`,"success"),F()}catch{n("שגיאה בהוספת קבצים","error")}},fe=async t=>{if(!s)return;const r={...s,todos:[...s.todos||[],{...t,projectId:void 0}],updatedAt:new Date().toISOString()};try{await q(r),n("המשימה נוספה בהצלחה","success"),F()}catch{n("שגיאה בהוספת משימה","error")}},je=()=>{Y.current?.click()},be=async t=>{const r=t.target.files?.[0];if(!(!r||!c)){_(!0),n("מעבד PDF (זה עשוי לקחת מספר דקות)...","info");try{const a=await new Promise((N,I)=>{const S=new FileReader;S.onload=T=>N(T.target?.result),S.onerror=T=>I(T),S.readAsDataURL(r)});n("שלב 1/3: מחלץ טקסט ותמונות מה-PDF...","info");const[D,w]=await Promise.all([le(a),Ve(a)]);w.length===0&&n("לא נמצאו תמונות ב-PDF. ממשיך עם טקסט בלבד.","warning"),n("שלב 2/3: שולח לניתוח AI...","info");const g=await Ke(D,w);n("שלב 3/3: יוצר דוח ובעיות...","info");const l={id:W(),projectId:c,title:g.title,date:g.date?new Date(g.date).toISOString():new Date().toISOString(),description:g.description,files:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},f=g.problems.map((N,I)=>{const T=(N.images||[]).map(M=>{const Q=w[M.imageIndex];return Q?{id:W(),name:`Image from page ${M.imageIndex+1}.jpg`,mimeType:"image/jpeg",dataUrl:Q,originalDataUrl:Q,annotationData:"[]",createdAt:new Date().toISOString(),caption:M.caption||`From page ${M.imageIndex+1}`}:null}).filter(M=>M!==null);return{id:W(),reportId:l.id,description:N.description||"No description from AI",severity:N.severity||R.LOW,notes:"",images:T,locationTag:N.locationTag,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),order:I,isFixed:!1}});await oe(l),await Promise.all(f.map(N=>_e(N))),n("דוח נוצר בהצלחה מ-PDF!","success"),F()}catch(a){console.error("Error creating report from PDF:",a),n(a instanceof Error?a.message:"שגיאה ביצירת הדוח","error")}finally{_(!1),t.target&&(t.target.value="")}}},we=()=>{K.current?.click()},Ne=async t=>{const r=t.target.files?.[0];if(!(!r||!s)){_(!0),n("מעבד קובץ דיירים...","info");try{let a="";if(r.type==="application/pdf"){const l=await new Promise((f,N)=>{const I=new FileReader;I.onload=S=>f(S.target?.result),I.onerror=S=>N(S),I.readAsDataURL(r)});a=await le(l)}else if(r.type==="text/csv")a=await r.text();else throw new Error("סוג קובץ לא נתמך. יש להעלות PDF או CSV.");const w=(await Xe(a)).map(l=>({id:W(),name:l.name||"N/A",phone:l.phone||"",email:l.email||"",building:l.building||"",floor:l.floor||"",officeNumber:l.officeNumber||"",officeSpace:l.officeSpace||"",companyId:l.companyId||""})),g={...s,tenants:[...s.tenants||[],...w],updatedAt:new Date().toISOString()};await q(g),n(`${w.length} דיירים נוספו בהצלחה!`,"success"),F()}catch(a){console.error("Error creating tenants from file:",a),n(a instanceof Error?a.message:"שגיאה ביצירת רשימת הדיירים","error")}finally{_(!1),t.target&&(t.target.value="")}}},ve=i.useMemo(()=>{if(!s)return[];const t=s.todos?.map(r=>r.group).filter(Boolean);return[...new Set(t)]},[s]),ye=i.useMemo(()=>s?.inventory?.some(t=>t.itemGroups.some(r=>r.name==="כלי עבודה חשמליים")),[s]);if(h)return e.jsx(ae,{text:"טוען פרטי בניין..."});if(!s)return e.jsx("div",{className:"text-center py-10 text-slate-500 text-lg",children:"בניין לא נמצא."});const X=s.images.length>0,Z=X?s.images[0].url||s.images[0].dataUrl:"",Ie=(u.images||[]).map(t=>({id:t.id,url:t.url,storagePath:t.storagePath,dataUrl:t.dataUrl,originalDataUrl:t.dataUrl,annotationData:"[]",name:t.name,mimeType:t.mimeType||"image/jpeg",createdAt:t.uploadedAt}));return e.jsxs("div",{className:"space-y-8",children:[me&&e.jsxs("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-60 backdrop-blur-sm flex flex-col items-center justify-center z-[1001]",children:[e.jsx(ae,{text:"מנתח קובץ בעזרת AI..."}),e.jsx("p",{className:"text-white/80 text-sm mt-2",children:"תהליך זה עשוי לקחת כדקה."})]}),e.jsx("section",{className:"bg-white shadow-xl rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:space-x-6 rtl:md:space-x-reverse",children:[X&&Z?e.jsx("img",{src:Z,alt:`תמונת בניין ${s.name}`,className:"w-full md:w-1/3 h-auto max-h-80 object-cover rounded-lg shadow mb-4 md:mb-0"}):e.jsx("div",{className:"w-full md:w-1/3 h-64 bg-sky-100 rounded-lg shadow mb-4 md:mb-0 flex items-center justify-center",children:e.jsx("span",{className:"text-6xl font-bold text-sky-600 opacity-50",children:tt(s.name)})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-3xl font-bold text-sky-700",children:s.name}),e.jsx("button",{onClick:()=>{U({...s}),E(!0)},className:"p-2 text-sky-600 hover:text-sky-700 transition-colors rounded-full hover:bg-sky-50",title:"ערוך פרטי בניין",children:e.jsx(Ae,{className:"w-6 h-6"})})]}),e.jsxs("p",{className:"text-slate-600 mb-1",children:[e.jsx("span",{className:"font-semibold",children:"כתובת:"})," ",s.address||"לא צוינה"]}),e.jsxs("p",{className:"text-slate-600 mb-1",children:[e.jsx("span",{className:"font-semibold",children:"לקוח:"})," ",s.clientInfo||"לא צוין"]}),s.managerName&&e.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-100",children:[e.jsxs("p",{className:"text-sm text-slate-600",children:[e.jsx("span",{className:"font-semibold",children:"מנהל בניין:"})," ",s.managerName]}),s.managerPhone&&e.jsxs("p",{className:"text-sm text-slate-600",children:[e.jsx("span",{className:"font-semibold",children:"טלפון:"})," ",e.jsx("a",{href:`tel:${s.managerPhone}`,className:"text-sky-600 hover:underline",children:s.managerPhone})]}),s.managerEmail&&e.jsxs("p",{className:"text-sm text-slate-600",children:[e.jsx("span",{className:"font-semibold",children:"אימייל:"})," ",e.jsx("a",{href:`mailto:${s.managerEmail}`,className:"text-sky-600 hover:underline",children:s.managerEmail})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-100 grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-500",children:"קומות"}),e.jsx("p",{className:"text-slate-800 text-lg font-bold",children:s.numberOfFloors??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-500",children:'שטח (מ"ר)'}),e.jsx("p",{className:"text-slate-800 text-lg font-bold",children:s.buildingArea??"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-500",children:"חניות"}),e.jsx("p",{className:"text-slate-800 text-lg font-bold",children:s.parkingSpots??"-"})]})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["נוצר ב: ",ne(s.createdAt)," | עודכן לאחרונה: ",ne(s.updatedAt)]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-200 flex flex-wrap items-center gap-3",children:[e.jsxs(Fe,{to:`/project/${s.id}/checklist`,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg shadow flex items-center justify-center transition-colors",children:[e.jsx(Te,{className:"w-5 h-5 me-2 rtl:ml-2"}),"רשימת תקלות לטיפול"]}),e.jsxs("button",{onClick:he,className:"bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-lg shadow flex items-center justify-center transition-colors",children:[e.jsx(Re,{className:"w-5 h-5 me-2 rtl:ml-2"}),"ייצא גיבוי"]})]})]})]})}),e.jsx(et,{project:s,problems:d}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsx(C,{to:`/project/${s.id}/reports`,icon:e.jsx(Oe,{className:"w-6 h-6"}),title:"דוחות",count:L.length,actionText:"הוסף דוח",onActionClick:()=>O(!0),secondaryActionText:"הוסף מ-PDF (AI)",onSecondaryActionClick:je,secondaryActionIcon:e.jsx(ie,{className:"w-5 h-5"})}),e.jsx(C,{to:`/project/${s.id}/forms`,icon:e.jsx(Ee,{className:"w-6 h-6"}),title:"טפסים",count:z.length}),e.jsx(C,{to:`/project/${s.id}/tenants`,icon:e.jsx(Ue,{className:"w-6 h-6"}),title:"דיירים",count:s.tenants?.length||0,secondaryActionText:"הוסף מ-PDF/CSV (AI)",onSecondaryActionClick:we,secondaryActionIcon:e.jsx(ie,{className:"w-5 h-5"})}),e.jsx(C,{to:`/project/${s.id}/workers`,icon:e.jsx(Me,{className:"w-6 h-6"}),title:"עובדי תחזוקה",count:s.workers?.length||0}),e.jsx(C,{to:`/project/${s.id}/notes`,icon:e.jsx($e,{className:"w-6 h-6"}),title:"הערות ומידע",count:s.notes?.length||0}),e.jsx(C,{to:`/project/${s.id}/sub-projects`,icon:e.jsx(Le,{className:"w-6 h-6"}),title:"פרויקטים",count:s.subProjects?.length||0}),e.jsx(C,{to:`/project/${s.id}/files`,icon:e.jsx(Be,{className:"w-6 h-6"}),title:"קבצים",count:s.files?.length||0,actionText:"הוסף קובץ",onActionClick:()=>v(!0)}),e.jsx(C,{to:`/project/${s.id}/todos`,icon:e.jsx(We,{className:"w-6 h-6"}),title:"משימות",count:s.todos?.length||0,actionText:"הוסף משימה",onActionClick:()=>A(!0)}),e.jsx(C,{to:`/project/${s.id}/inventory`,icon:e.jsx(Ge,{className:"w-6 h-6"}),title:"מלאי",count:s.inventory?.flatMap(t=>t.itemGroups).flatMap(t=>t.items).length||0}),ye&&e.jsx(C,{to:`/project/${s.id}/electrical-tools`,icon:e.jsx(He,{className:"w-6 h-6"}),title:"בדיקת כלי עבודה חשמליים",count:s.inventory?.flatMap(t=>t.itemGroups).find(t=>t.name==="כלי עבודה חשמליים")?.items.length||0})]}),e.jsx("input",{type:"file",ref:Y,onChange:be,accept:"application/pdf",className:"hidden"}),e.jsx("input",{type:"file",ref:K,onChange:Ne,accept:"application/pdf,text/csv",className:"hidden"}),e.jsx(re,{isOpen:P,onClose:()=>O(!1),title:"הוספת דוח חדש",size:"lg",children:e.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-title",className:"block text-sm font-medium text-slate-700",children:"כותרת הדוח"}),e.jsx("input",{type:"text",name:"title",id:"report-title",value:p.title||"",onChange:t=>x(t,"newReport"),required:!0,className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-date",className:"block text-sm font-medium text-slate-700",children:"תאריך הדוח"}),e.jsx("input",{type:"date",name:"date",id:"report-date",value:p.date||"",onChange:t=>x(t,"newReport"),required:!0,className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-group",className:"block text-sm font-medium text-slate-700",children:"קבוצה (אופציונלי)"}),e.jsx("input",{type:"text",name:"group",id:"report-group",value:p.group||"",onChange:t=>x(t,"newReport"),className:"mt-1 block w-full input-class",placeholder:"לדוגמה: בדיקות איטום"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-description",className:"block text-sm font-medium text-slate-700",children:"תיאור (אופציונלי)"}),e.jsx("textarea",{name:"description",id:"report-description",value:p.description||"",onChange:t=>x(t,"newReport"),rows:4,className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-workers",className:"block text-sm font-medium text-slate-700",children:"עובדים משויכים (אופציונלי)"}),e.jsx("select",{multiple:!0,name:"workerIds",id:"report-workers",value:p.workerIds||[],onChange:t=>x(t,"newReport"),className:"mt-1 block w-full input-class h-24",children:(s?.workers||[]).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-suppliers",className:"block text-sm font-medium text-slate-700",children:"ספקים משויכים (אופציונלי)"}),e.jsx("select",{multiple:!0,name:"supplierIds",id:"report-suppliers",value:p.supplierIds||[],onChange:t=>x(t,"newReport"),className:"mt-1 block w-full input-class h-24",children:m.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.group,")"]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-tenants",className:"block text-sm font-medium text-slate-700",children:"דיירים משויכים (אופציונלי)"}),e.jsx("select",{multiple:!0,name:"tenantIds",id:"report-tenants",value:p.tenantIds||[],onChange:t=>x(t,"newReport"),className:"mt-1 block w-full input-class h-24",children:(s?.tenants||[]).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 rtl:space-x-reverse pt-2",children:[e.jsx("button",{type:"button",onClick:()=>O(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"צור דוח"})]})]})}),e.jsx(re,{isOpen:V,onClose:()=>{E(!1)},title:"עריכת פרטי בניין",size:"lg",children:e.jsxs("form",{onSubmit:xe,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-name",className:"block text-sm font-medium text-slate-700",children:"שם הבניין"}),e.jsx("input",{type:"text",name:"name",id:"edit-name",value:u.name||"",onChange:t=>x(t,"editProject"),required:!0,className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-address",className:"block text-sm font-medium text-slate-700",children:"כתובת"}),e.jsx("input",{type:"text",name:"address",id:"edit-address",value:u.address||"",onChange:t=>x(t,"editProject"),className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-clientInfo",className:"block text-sm font-medium text-slate-700",children:"פרטי לקוח"}),e.jsx("textarea",{name:"clientInfo",id:"edit-clientInfo",value:u.clientInfo||"",onChange:t=>x(t,"editProject"),rows:3,className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-md font-medium text-slate-800 mb-2",children:"פרטי מנהל בניין"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"managerName",className:"block text-sm font-medium text-slate-700",children:"שם מנהל"}),e.jsx("input",{type:"text",name:"managerName",id:"managerName",value:u.managerName||"",onChange:t=>x(t,"editProject"),className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"managerPhone",className:"block text-sm font-medium text-slate-700",children:"טלפון"}),e.jsx("input",{type:"tel",name:"managerPhone",id:"managerPhone",value:u.managerPhone||"",onChange:t=>x(t,"editProject"),className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{htmlFor:"managerEmail",className:"block text-sm font-medium text-slate-700",children:"אימייל"}),e.jsx("input",{type:"email",name:"managerEmail",id:"managerEmail",value:u.managerEmail||"",onChange:t=>x(t,"editProject"),className:"mt-1 block w-full input-class"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-numberOfFloors",className:"block text-sm font-medium text-slate-700",children:"כמות קומות"}),e.jsx("input",{type:"number",name:"numberOfFloors",id:"edit-numberOfFloors",value:u.numberOfFloors||"",onChange:t=>x(t,"editProject"),className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-buildingArea",className:"block text-sm font-medium text-slate-700",children:'שטח (מ"ר)'}),e.jsx("input",{type:"number",name:"buildingArea",id:"edit-buildingArea",value:u.buildingArea||"",onChange:t=>x(t,"editProject"),className:"mt-1 block w-full input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-parkingSpots",className:"block text-sm font-medium text-slate-700",children:"חניות"}),e.jsx("input",{type:"number",name:"parkingSpots",id:"edit-parkingSpots",value:u.parkingSpots||"",onChange:t=>x(t,"editProject"),className:"mt-1 block w-full input-class"})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(qe,{images:Ie,onImagesChange:pe,maxImages:5,allowNotes:!1})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>E(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{type:"submit",className:"btn-primary",children:"שמור שינויים"})]})]})}),e.jsx(Je,{isOpen:o,onClose:()=>v(!1),onSave:ge}),e.jsx(Ye,{isOpen:k,onClose:()=>A(!1),onSave:fe,groupSuggestions:ve,projects:s?[s]:[]})]})};export{jt as default};
