import{r as o,h as D,u as E,j as e,F as I,Q as O,L as P}from"./index-D-cHbBwn.js";import{C as x,r as k}from"./chart-Zj-L_LRF.js";import{f as R}from"./dateFormatter-CUKId3Gl.js";import{b as T}from"./emailService-Ce1ZuM1T.js";import{E as F}from"./ContactIcons-B1NAvYGF.js";import{C as W}from"./CollapsibleSection-F92uqtdU.js";x.register(...k);const A=t=>{switch(t){case"פעיל":return"#3b82f6";case"הושלם":return"#22c55e";case"בהמתנה":return"#f59e0b";case"בוטל":return"#64748b";default:return"#a1a1aa"}},r=({title:t,value:i,colorClass:p})=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md flex-grow text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-slate-800",children:i}),e.jsx("p",{className:`text-sm font-medium ${p}`,children:t})]}),U=({stats:t,projects:i,statusChartRef:p,issuesChartRef:j,className:b})=>{const C=o.useRef(null),v=o.useRef(null),c=p||C,d=j||v,{settings:a}=D(),{addToast:f}=E(),g=o.useMemo(()=>{const s=Object.keys(t.statusCounts),l=Object.values(t.statusCounts),m=s.map(h=>A(h));return{labels:s,datasets:[{label:"בניינים לפי סטטוס",data:l,backgroundColor:m,borderColor:"#ffffff",borderWidth:2}]}},[t.statusCounts]),u=o.useMemo(()=>{const s=new Map(i.map(n=>[n.id,n.name])),l=t.criticalIssuesByProject,m=Object.entries(l).sort((n,S)=>Number(S[1])-Number(n[1])).slice(0,5),h=m.map(([n])=>s.get(n)||"Unknown Project"),w=m.map(([,n])=>n);return{labels:h,datasets:[{label:"תקלות קריטיות פתוחות",data:w,backgroundColor:"rgba(239, 68, 68, 0.6)",borderColor:"rgba(220, 38, 38, 1)",borderWidth:1}]}},[i,t.criticalIssuesByProject]);o.useEffect(()=>{let s=null;if(c.current){const l=x.getChart(c.current);l&&l.destroy(),s=new x(c.current,{type:"doughnut",data:g,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{font:{family:"Heebo"}}}}}})}return()=>s?.destroy()},[g,c]),o.useEffect(()=>{let s=null;if(d.current&&u.labels.length>0){const l=x.getChart(d.current);l&&l.destroy(),s=new x(d.current,{type:"bar",data:u,options:{responsive:!0,maintainAspectRatio:!1,indexAxis:"y",plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,ticks:{precision:0}},y:{ticks:{font:{family:"Heebo"}}}}}})}return()=>s?.destroy()},[u,d]);const y=()=>{if(!a.notificationEmailAddress){f("יש להגדיר כתובת מייל בהגדרות.","warning");return}T(t,a),f("פותח תוכנת מייל עם סיכום...","info")},N=a.enableEmailNotifications&&(a.notifyOnFileDueSoon||a.notifyOnFileExpired||a.notifyOnTodoDueSoon||a.notifyOnTodoExpired||a.notifyOnPermitDueSoon||a.notifyOnPermitExpired||a.notifyOnWarrantyDueSoon||a.notifyOnWarrantyExpired);return e.jsxs(W,{title:e.jsx("h2",{className:"text-2xl font-semibold",children:"לוח בקרה (Dashboard)"}),defaultOpen:!0,className:b,children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6",children:[e.jsx(r,{title:"סה״כ בניינים",value:t.totalProjects,colorClass:"text-slate-500"}),e.jsx(r,{title:"בניינים פעילים",value:t.activeProjects,colorClass:"text-blue-500"}),e.jsx(r,{title:"סה״כ תקלות פתוחות",value:t.totalOpenIssues,colorClass:"text-amber-500"}),e.jsx(r,{title:"תקלות קריטיות פתוחות",value:t.openCriticalIssues,colorClass:"text-red-500"}),e.jsx(r,{title:"קבצים שפג תוקפם",value:t.expiredFiles,colorClass:"text-orange-500"}),e.jsx(r,{title:"משימות שפג תוקפן",value:t.expiredTodos,colorClass:"text-orange-500"}),e.jsx(r,{title:"היתרים שפג תוקפם",value:t.expiredPermits,colorClass:"text-orange-500"}),e.jsx(r,{title:"אחריות שפג תוקפה",value:t.expiredWarranties,colorClass:"text-orange-500"}),e.jsx(r,{title:"קבצים לקראת תפוגה",value:t.dueSoonFiles,colorClass:"text-purple-500"}),e.jsx(r,{title:"משימות לקראת תפוגה",value:t.dueSoonTodos,colorClass:"text-purple-500"}),e.jsx(r,{title:"היתרים לקראת תפוגה",value:t.dueSoonPermits,colorClass:"text-purple-500"}),e.jsx(r,{title:"אחריות לקראת תפוגה",value:t.dueSoonWarranties,colorClass:"text-purple-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"font-semibold text-slate-700 mb-2 text-center",children:"בניינים לפי סטטוס"}),e.jsx("div",{className:"relative h-64",children:i.length>0?e.jsx("canvas",{ref:c}):e.jsx("p",{className:"text-center text-slate-400 pt-16",children:"אין נתוני בניינים להצגה."})})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[e.jsx("h3",{className:"font-semibold text-slate-700 mb-2 text-center",children:"בניינים עם הכי הרבה תקלות קריטיות"}),e.jsx("div",{className:"relative h-64",children:u.labels.length>0?e.jsx("canvas",{ref:d}):e.jsx("p",{className:"text-center text-slate-400 pt-16",children:"אין תקלות קריטיות פתוחות."})})]}),e.jsxs("div",{className:"lg:col-span-2 bg-white p-4 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-slate-700 text-center",children:"משימות ותוקף קבצים קרובים (5 הבאים)"}),N&&e.jsxs("button",{onClick:y,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-sky-700 bg-sky-100 rounded-lg hover:bg-sky-200 transition-colors",children:[e.jsx(F,{className:"w-5 h-5"}),"שלח סיכום התראות במייל"]})]}),t.upcomingTasks.length>0?e.jsx("ul",{className:"space-y-3",children:t.upcomingTasks.map(s=>e.jsxs("li",{className:"flex items-center justify-between p-2 bg-slate-50 rounded-md hover:bg-slate-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[s.type==="file"?e.jsx(I,{className:"w-6 h-6 text-sky-500 flex-shrink-0"}):e.jsx(O,{className:"w-6 h-6 text-purple-500 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-slate-800 text-sm truncate",title:s.name,children:s.name}),e.jsx("p",{className:"text-xs text-slate-500",children:e.jsx(P,{to:`/project/${s.projectId}`,className:"hover:underline",children:s.projectName})})]})]}),e.jsx("div",{className:"text-sm font-semibold text-slate-700 text-right flex-shrink-0 ml-2",children:R(s.dueDate)})]},`${s.type}-${s.id}`))}):e.jsx("p",{className:"text-center text-slate-400 py-4",children:"אין משימות או קבצים עם תאריך יעד קרוב."})]})]})]})};export{U as D};
