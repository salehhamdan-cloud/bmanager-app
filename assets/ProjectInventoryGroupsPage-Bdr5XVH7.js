import{k as F,B as H,r as l,u as J,l as K,j as e,a as Q,L as G,P as V,p as W,T as X,M as Y,z as I,e as L,aM as Z}from"./index-BU7E-q7q.js";const ee=()=>{const{projectId:c,locationId:m}=F(),b=H(),[d,T]=l.useState(null),[r,$]=l.useState(null),[A,S]=l.useState(!0),{addToast:i}=J(),[O,x]=l.useState(!1),[o,p]=l.useState(null),[w,k]=l.useState("add"),[f,v]=l.useState("list"),[N,z]=l.useState([]),[h,j]=l.useState(new Set),[g,P]=l.useState(""),y=l.useCallback(async()=>{if(!(!c||!m)){S(!0);try{const s=await K(c);if(s){T(s);const n=s.inventory?.find(a=>a.id===m);n?$(n):(i("מיקום לא נמצא","error"),b(`/project/${c}/inventory`))}else i("בניין לא נמצא","error"),b("/inventory")}catch{i("שגיאה בטעינת קבוצות הפריטים","error")}finally{S(!1)}}},[c,m,i,b]);l.useEffect(()=>{y()},[y]);const D=async()=>{try{const s=await Z(),n=new Set(r?.itemGroups.map(a=>a.name)||[]);z(s.filter(a=>!n.has(a)))}catch{i("שגיאה בטעינת קבוצות מוכנות","error")}},C=(s=null)=>{s?(p({...s}),k("edit")):(p({name:""}),j(new Set),P(""),k("add"),v("list"),D()),x(!0)},E=async()=>{if(!d||!r)return;let s=null,n="";if(w==="edit"){if(!o||!o.name?.trim()||!o.id){i("שם הקבוצה הוא שדה חובה","warning");return}s={...r,itemGroups:r.itemGroups.map(t=>t.id===o.id?o:t)},n="הקבוצה עודכנה"}else if(f==="new"){if(!o||!o.name?.trim()){i("שם הקבוצה הוא שדה חובה","warning");return}const t={id:L(),name:o.name.trim(),items:[]};s={...r,itemGroups:[...r.itemGroups,t]},n="קבוצה חדשה נוספה"}else{if(h.size===0){i("יש לבחור לפחות קבוצה אחת להוספה","warning");return}const t=Array.from(h).map(U=>({id:L(),name:U,items:[]}));s={...r,itemGroups:[...r.itemGroups,...t]},n=`${t.length} קבוצות נוספו`}if(!s)return;const a={...d,inventory:(d.inventory||[]).map(t=>t.id===m?s:t),updatedAt:new Date().toISOString()};try{await I(a),i(n,"success"),x(!1),p(null),y()}catch{i("שגיאה בשמירת הקבוצה","error")}},B=async s=>{if(!d||!r||!window.confirm("האם למחוק קבוצה זו וכל הפריטים שבתוכה?"))return;const n={...r,itemGroups:r.itemGroups.filter(t=>t.id!==s)},a={...d,inventory:(d.inventory||[]).map(t=>t.id===m?n:t),updatedAt:new Date().toISOString()};try{await I(a),i("הקבוצה נמחקה","success"),y()}catch{i("שגיאה במחיקת הקבוצה","error")}},q=s=>{j(n=>{const a=new Set(n);return a.has(s)?a.delete(s):a.add(s),a})},u=l.useMemo(()=>g?N.filter(s=>s.toLowerCase().includes(g.toLowerCase())):N,[N,g]),R=()=>{h.size===u.length&&u.length>0?j(new Set):j(new Set(u))};if(A)return e.jsx(Q,{text:"טוען קבוצות פריטים..."});const M=({label:s,active:n,onClick:a})=>e.jsx("button",{onClick:a,className:`px-4 py-2 text-sm font-medium rounded-md ${n?"bg-sky-600 text-white":"bg-slate-200 text-slate-700 hover:bg-slate-300"}`,children:s});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("nav",{className:"text-sm mb-1",children:[e.jsx(G,{to:`/project/${c}`,className:"text-sky-600 hover:underline",children:d?.name}),e.jsx("span",{className:"text-slate-500 mx-2",children:"/"}),e.jsx(G,{to:`/project/${c}/inventory`,className:"text-sky-600 hover:underline",children:"מלאי"})]}),e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:r?.name})]}),e.jsxs("button",{onClick:()=>C(),className:"btn-primary flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"הוסף קבוצה"]})]}),(r?.itemGroups.length||0)===0?e.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:e.jsx("p",{className:"text-slate-500",children:"לא נמצאו קבוצות פריטים. התחל על ידי הוספת קבוצה חדשה."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r?.itemGroups.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-sky-700 truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.items.length," פריטים"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-3 border-t",children:[e.jsx(G,{to:`/project/${c}/inventory/location/${m}/group/${s.id}`,className:"text-sm font-medium text-sky-600 hover:underline",children:"צפה בפריטים"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>C(s),className:"p-1.5 text-slate-500 hover:bg-slate-100 rounded-full",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(s.id),className:"p-1.5 text-red-500 hover:bg-red-100 rounded-full",children:e.jsx(X,{className:"w-4 h-4"})})]})]})]},s.id))}),e.jsxs(Y,{isOpen:O,onClose:()=>x(!1),title:w==="edit"?"עריכת קבוצה":"הוספת קבוצות חדשות",children:[w==="edit"?e.jsx("div",{className:"space-y-4",children:e.jsx("input",{type:"text",placeholder:"שם הקבוצה",value:o?.name||"",onChange:s=>p({...o,name:s.target.value}),className:"input-class w-full"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 p-1 bg-slate-100 rounded-lg",children:[e.jsx(M,{label:"הוספה מרשימה",active:f==="list",onClick:()=>v("list")}),e.jsx(M,{label:"יצירה חדשה",active:f==="new",onClick:()=>v("new")})]}),f==="new"?e.jsx("input",{type:"text",placeholder:"שם הקבוצה החדשה",value:o?.name||"",onChange:s=>p({...o,name:s.target.value}),className:"input-class w-full"}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"search",placeholder:"חפש קבוצה...",value:g,onChange:s=>P(s.target.value),className:"input-class w-full"}),u.length>0&&e.jsx("button",{onClick:R,className:"btn-secondary text-sm whitespace-nowrap",children:h.size===u.length?"בטל בחירה":"בחר הכל"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto border rounded-md p-2 space-y-1",children:u.length>0?u.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-sky-50 rounded-md cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:h.has(s),onChange:()=>q(s),className:"w-4 h-4 text-sky-600 rounded focus:ring-sky-500"}),e.jsx("span",{children:s})]},s)):e.jsx("p",{className:"text-slate-500 text-center p-4",children:"אין קבוצות מוכנות להוספה."})})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>x(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:E,className:"btn-primary",children:"שמור"})]})]}),e.jsx("style",{children:`
                .input-class { display: block; width: 100%; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.5rem 0.75rem; }
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
            `})]})};export{ee as default};
