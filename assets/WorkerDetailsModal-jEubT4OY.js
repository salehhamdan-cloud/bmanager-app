import{r as f,u as $,j as e,M as b,e as m,P as S,T as v,p as T,A as y}from"./index-BU7E-q7q.js";import{I as L}from"./ImageUploader-DcmZM9_9.js";import{P as w,E as C,M as E}from"./ContactIcons-BhgvhBQE.js";import{g as p}from"./dateFormatter-CUKId3Gl.js";const j=({permit:s,onChange:n,label:a})=>{const c=async l=>{const o=l.target.files?.[0];if(o){const u=new FileReader;u.onload=i=>{n({id:s?.id||m(),name:o.name,mimeType:o.type,dataUrl:i.target?.result,url:void 0,storagePath:void 0})},u.readAsDataURL(o)}},r=l=>{n({validUntil:l.target.value?new Date(l.target.value).toISOString():void 0})};return e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:a}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mt-1",children:[e.jsx("input",{type:"file",onChange:c,className:"file-input-class"}),e.jsx("input",{type:"date",value:s?.validUntil?.split("T")[0]||"",onChange:r,className:"input-class"})]}),s?.name&&e.jsxs("p",{className:"text-xs text-slate-500 mt-1 truncate",children:["קובץ נוכחי: ",s.name]})]})},q=({isOpen:s,onClose:n,onSave:a,worker:c,projects:r})=>{const[l,o]=f.useState({}),{addToast:u}=$();f.useEffect(()=>{s&&o(c||{projectId:r.length===1?r[0].id:"",name:"",phone:"",email:"",address:"",idNumber:"",workerNumber:"",licenses:[]})},[s,c,r]);const i=(t,d)=>{o(x=>({...x,[t]:d}))},P=f.useCallback(t=>{if(t.length>0){const{id:d,annotationData:x,createdAt:h,originalDataUrl:F,...D}=t[0];i("photo",D)}else i("photo",void 0)},[]),I=()=>{const t={id:m(),name:""};i("licenses",[...l.licenses||[],t])},g=(t,d)=>{const x=(l.licenses||[]).map(h=>h.id===t?{...h,...d}:h);i("licenses",x)},U=t=>{i("licenses",(l.licenses||[]).filter(d=>d.id!==t))},A=()=>{a(l)};if(!s)return null;const k=l.photo?[{id:"worker-photo",...l.photo,annotationData:"[]",createdAt:new Date().toISOString()}]:[];return e.jsxs(b,{isOpen:s,onClose:n,title:l.id?"עריכת עובד":"הוספת עובד חדש",size:"lg",children:[e.jsxs("div",{className:"space-y-4 max-h-[75vh] overflow-y-auto p-1",children:[r.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"בניין*"}),e.jsxs("select",{value:l.projectId||"",onChange:t=>i("projectId",t.target.value),className:"input-class w-full",children:[e.jsx("option",{value:"",disabled:!0,children:"בחר בניין..."}),r.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start",children:[e.jsxs("div",{className:"w-full sm:w-2/3 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"שם מלא*",value:l.name||"",onChange:t=>i("name",t.target.value),className:"input-class"}),e.jsx("input",{type:"text",placeholder:"מספר ת.ז.",value:l.idNumber||"",onChange:t=>i("idNumber",t.target.value),className:"input-class"}),e.jsx("input",{type:"text",placeholder:"מספר עובד",value:l.workerNumber||"",onChange:t=>i("workerNumber",t.target.value),className:"input-class"}),e.jsx("input",{type:"tel",placeholder:"טלפון",value:l.phone||"",onChange:t=>i("phone",t.target.value),className:"input-class"})]}),e.jsx("input",{type:"email",placeholder:"אימייל",value:l.email||"",onChange:t=>i("email",t.target.value),className:"input-class w-full"}),e.jsx("input",{type:"text",placeholder:"כתובת",value:l.address||"",onChange:t=>i("address",t.target.value),className:"input-class w-full"})]}),e.jsxs("div",{className:"w-full sm:w-1/3",children:[e.jsx("label",{className:"label-class",children:"תמונת פרופיל"}),e.jsx(L,{images:k,onImagesChange:P,maxImages:1,allowNotes:!1})]})]}),e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsx("h3",{className:"text-md font-semibold text-slate-700",children:"היתרים"}),e.jsx(j,{label:"היתר עבודה בגובה",permit:l.workAtHeightPermit,onChange:t=>i("workAtHeightPermit",{...l.workAtHeightPermit||{id:m()},...t})}),e.jsx(j,{label:"היתר בטיחות",permit:l.safetyPermit,onChange:t=>i("safetyPermit",{...l.safetyPermit||{id:m()},...t})})]}),e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-md font-semibold text-slate-700",children:"רישיונות"}),e.jsxs("button",{type:"button",onClick:I,className:"btn-secondary text-sm flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4"})," הוסף רישיון"]})]}),(l.licenses||[]).map(t=>e.jsxs("div",{className:"p-3 bg-slate-50 rounded-md border space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"שם הרישיון (למשל, חשמלאי מוסמך)",value:t.name,onChange:d=>g(t.id,{name:d.target.value}),className:"input-class w-full"}),e.jsx("button",{type:"button",onClick:()=>U(t.id),className:"p-2 text-red-500 hover:bg-red-100 rounded-full flex-shrink-0",children:e.jsx(v,{className:"w-4 h-4"})})]}),e.jsx(j,{label:"קובץ ותוקף",permit:t.file,onChange:d=>g(t.id,{file:{...t.file||{id:m(),name:"",mimeType:""},...d}})})]},t.id))]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:n,className:"btn-secondary",children:"ביטול"}),e.jsx("button",{type:"button",onClick:A,className:"btn-primary",children:"שמור עובד"})]})]}),e.jsx("style",{children:`
                .label-class { display: block; margin-bottom: 0.25rem; font-size: 0.875rem; font-weight: 500; color: #334155; }
                .input-class { display: block; width: 100%; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.5rem 0.75rem; }
                .file-input-class { display: block; width: 100%; text-sm text-slate-500 file:mr-4 file:rtl:ml-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-sky-50 file:text-sky-700 hover:file:bg-sky-100 border border-slate-300 rounded-lg}
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
            `})]})},H=s=>s?s.split(" ").map(n=>n[0]).slice(0,2).join("").toUpperCase():"?",B=({worker:s,onSelect:n,onEdit:a,onDelete:c})=>{const r=s.photo?.url||s.photo?.dataUrl;return e.jsxs("div",{className:"bg-white rounded-xl shadow-md border border-slate-200/80 overflow-hidden flex flex-col transition-all duration-300 hover:shadow-lg hover:border-sky-200",children:[e.jsxs("div",{className:"p-4 flex items-start gap-4 cursor-pointer",onClick:n,children:[e.jsx("div",{className:"flex-shrink-0",children:r?e.jsx("img",{src:r,alt:s.name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-200 flex items-center justify-center text-xl font-bold text-slate-500",children:H(s.name)})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsx("p",{className:"font-bold text-lg text-slate-800 truncate",title:s.name,children:s.name}),e.jsx("p",{className:"text-sm text-slate-500 truncate",children:s.projectName}),e.jsxs("div",{className:"mt-2 space-y-1 text-xs",children:[e.jsxs("p",{className:"flex items-center gap-2 text-slate-600 truncate",children:[e.jsx(w,{className:"w-3 h-3 text-slate-400"}),e.jsx("a",{href:`tel:${s.phone}`,className:"hover:underline",children:s.phone})]}),e.jsxs("p",{className:"flex items-center gap-2 text-slate-600 truncate",children:[e.jsx(C,{className:"w-3 h-3 text-slate-400"}),e.jsx("a",{href:`mailto:${s.email}`,className:"hover:underline",children:s.email})]})]})]})]}),e.jsxs("div",{className:"mt-auto p-2 bg-slate-50 border-t flex justify-end gap-1",children:[e.jsx("button",{onClick:a,className:"p-2 text-slate-500 hover:text-sky-600 hover:bg-sky-100 rounded-full transition-colors",title:"ערוך פרטי עובד",children:e.jsx(T,{className:"w-4 h-4"})}),e.jsx("button",{onClick:c,className:"p-2 text-slate-500 hover:text-red-600 hover:bg-red-100 rounded-full transition-colors",title:"מחק עובד",children:e.jsx(v,{className:"w-4 h-4"})})]})]})},M=s=>s?s.split(" ").map(n=>n[0]).slice(0,2).join("").toUpperCase():"?",N=({permit:s,label:n})=>{const a=p(s.validUntil);return e.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-100 rounded-md",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${a.bg} ${a.color}`,children:a.text})]}),s.url&&e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-sky-600 hover:bg-sky-100 rounded-full",title:`הורד ${n}`,children:e.jsx(y,{className:"w-5 h-5"})})]})},R=({license:s})=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-slate-100 rounded-md",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),s.file?.validUntil?e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${p(s.file.validUntil).bg} ${p(s.file.validUntil).color}`,children:p(s.file.validUntil).text}):e.jsx("p",{className:"text-xs text-slate-500",children:"אין תאריך תוקף"})]}),s.file?.url&&e.jsx("a",{href:s.file.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-sky-600 hover:bg-sky-100 rounded-full",title:`הורד ${s.name}`,children:e.jsx(y,{className:"w-5 h-5"})})]}),G=({isOpen:s,onClose:n,worker:a})=>{if(!a)return null;const c=a.photo?.url||a.photo?.dataUrl;return e.jsx(b,{isOpen:s,onClose:n,title:"פרטי עובד",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:c?e.jsx("img",{src:c,alt:a.name,className:"w-24 h-24 rounded-full object-cover shadow-md"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-slate-200 flex items-center justify-center text-3xl font-bold text-slate-500 shadow-md",children:M(a.name)})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:a.name}),e.jsx("p",{className:"text-slate-500",children:a.projectName}),e.jsxs("div",{className:"mt-4 space-y-2 text-sm text-slate-600",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-slate-400"})," ",e.jsx("a",{href:`tel:${a.phone}`,className:"text-sky-600 hover:underline",children:a.phone})]}),e.jsxs("p",{className:"flex items-center gap-2 truncate",children:[e.jsx(C,{className:"w-4 h-4 text-slate-400"})," ",e.jsx("a",{href:`mailto:${a.email}`,className:"text-sky-600 hover:underline truncate",children:a.email})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 text-slate-400"})," ",a.address||"לא צוינה כתובת"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-slate-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"ת.ז"}),e.jsx("p",{children:a.idNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"מספר עובד"}),e.jsx("p",{children:a.workerNumber})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-slate-700",children:"היתרים ורישיונות"}),a.workAtHeightPermit&&e.jsx(N,{permit:a.workAtHeightPermit,label:"היתר עבודה בגובה"}),a.safetyPermit&&e.jsx(N,{permit:a.safetyPermit,label:"היתר בטיחות"}),a.licenses.map(r=>e.jsx(R,{license:r},r.id)),!a.workAtHeightPermit&&!a.safetyPermit&&a.licenses.length===0&&e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:"לא הוגדרו היתרים או רישיונות."})]})]})})};export{q as A,B as W,G as a};
