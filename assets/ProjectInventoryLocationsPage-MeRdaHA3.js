import{k as N,B as w,r as i,u as k,l as L,j as e,a as P,L as p,P as I,p as S,T as C,M,z as j,e as O}from"./index-D-cHbBwn.js";const E=()=>{const{projectId:o}=N(),m=w(),[t,f]=i.useState(null),[g,u]=i.useState(!0),{addToast:n}=k(),[y,c]=i.useState(!1),[a,d]=i.useState(null),l=i.useCallback(async()=>{if(o){u(!0);try{const s=await L(o);s?f(s):(n("בניין לא נמצא","error"),m("/inventory"))}catch{n("שגיאה בטעינת המיקומים","error")}finally{u(!1)}}},[o,n,m]);i.useEffect(()=>{l()},[l]);const x=(s=null)=>{d(s?{...s}:{name:""}),c(!0)},b=async()=>{if(!a||!a.name?.trim()||!t){n("שם המיקום הוא שדה חובה","warning");return}let s;if(a.id)s={...t,inventory:(t.inventory||[]).map(r=>r.id===a.id?a:r)};else{const r={id:O(),name:a.name.trim(),itemGroups:[]};s={...t,inventory:[...t.inventory||[],r]}}s.updatedAt=new Date().toISOString();try{await j(s),n("המיקום נשמר","success"),c(!1),d(null),l()}catch{n("שגיאה בשמירת המיקום","error")}},v=async s=>{if(!t||!window.confirm("האם למחוק מיקום זה וכל תכולתו?"))return;const r={...t,inventory:(t.inventory||[]).filter(h=>h.id!==s),updatedAt:new Date().toISOString()};try{await j(r),n("המיקום נמחק","success"),l()}catch{n("שגיאה במחיקת המיקום","error")}};return g?e.jsx(P,{text:"טוען מיקומים..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("nav",{className:"text-sm mb-1",children:e.jsx(p,{to:`/project/${o}`,className:"text-sky-600 hover:underline",children:"חזרה לבניין"})}),e.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["מלאי: ",t?.name]})]}),e.jsxs("button",{onClick:()=>x(),className:"btn-primary flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"הוסף מיקום"]})]}),(t?.inventory?.length||0)===0?e.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:e.jsx("p",{className:"text-slate-500",children:"לא נמצאו מיקומים. התחל על ידי הוספת מיקום חדש (למשל: מחסן, קומה 2)."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t?.inventory?.map(s=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-sky-700 truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.itemGroups.length," קבוצות פריטים"]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-3 border-t",children:[e.jsx(p,{to:`/project/${o}/inventory/location/${s.id}`,className:"text-sm font-medium text-sky-600 hover:underline",children:"צפה בקבוצות"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>x(s),className:"p-1.5 text-slate-500 hover:bg-slate-100 rounded-full",children:e.jsx(S,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(s.id),className:"p-1.5 text-red-500 hover:bg-red-100 rounded-full",children:e.jsx(C,{className:"w-4 h-4"})})]})]})]},s.id))}),e.jsx(M,{isOpen:y,onClose:()=>c(!1),title:a?.id?"עריכת מיקום":"הוספת מיקום חדש",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"שם המיקום (לדוגמה: קומה 2, מדף 12)",value:a?.name||"",onChange:s=>d({...a,name:s.target.value}),className:"input-class w-full"}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>c(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:b,className:"btn-primary",children:"שמור"})]})]})}),e.jsx("style",{children:`
                .input-class { display: block; width: 100%; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.5rem 0.75rem; }
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
            `})]})};export{E as default};
