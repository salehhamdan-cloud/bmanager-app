import{k,B as P,r as o,u as S,h as T,l as E,j as e,a as M,L as $,A as f,P as D,p as L,T as O,M as A,z as g,e as z}from"./index-D-cHbBwn.js";import{P as B,E as F,M as R}from"./ContactIcons-B1NAvYGF.js";import{e as _}from"./exportUtils-Bak1EFUX.js";import{l as q}from"./pdfService-D-0A9fw7.js";import"./dateFormatter-CUKId3Gl.js";const U=()=>{const{projectId:i}=k(),p=P(),[t,j]=o.useState(null),[N,u]=o.useState(!0),{addToast:r}=S(),{settings:b}=T(),[v,d]=o.useState(!1),[l,n]=o.useState(null),m=o.useCallback(async()=>{if(i){u(!0);try{const s=await E(i);s?j(s):(r("בניין לא נמצא","error"),p("/"))}catch{r("שגיאה בטעינת דיירים","error")}finally{u(!1)}}},[i,r,p]);o.useEffect(()=>{m()},[m]);const x=(s=null)=>{n(s?{...s}:{name:"",phone:"",email:"",building:"",floor:"",officeNumber:"",officeSpace:"",companyId:""}),d(!0)},y=async()=>{if(!l||!l.name?.trim()||!t){r("שם הדייר הוא שדה חובה","warning");return}let s;if(l.id)s=(t.tenants||[]).map(c=>c.id===l.id?l:c);else{const c={id:z(),...l,name:l.name.trim()};s=[...t.tenants||[],c]}const a={...t,tenants:s,updatedAt:new Date().toISOString()};try{await g(a),r("הדייר נשמר","success"),d(!1),n(null),m()}catch{r("שגיאה בשמירת הדייר","error")}},w=async s=>{if(!t||!window.confirm("האם למחוק דייר זה?"))return;const a={...t,tenants:(t.tenants||[]).filter(c=>c.id!==s),updatedAt:new Date().toISOString()};try{await g(a),r("הדייר נמחק","success"),m()}catch{r("שגיאה במחיקת הדייר","error")}},C=()=>{if(!t||!t.tenants)return;const s=t.tenants.map(a=>({שם:a.name,טלפון:a.phone,מייל:a.email,אגף:a.building,קומה:a.floor,משרד:a.officeNumber,שטח:a.officeSpace,"ח.פ":a.companyId||""}));_(s,`tenants_${t.name}`)},I=()=>{!t||!t.tenants||q({settings:b,project:t,tenants:t.tenants})};if(N)return e.jsx(M,{text:"טוען דיירים..."});const h=t?.tenants||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("nav",{className:"text-sm mb-1",children:e.jsx($,{to:`/project/${i}`,className:"text-sky-600 hover:underline",children:"חזרה לבניין"})}),e.jsxs("h2",{className:"text-2xl font-semibold text-slate-700",children:["דיירים עבור: ",t?.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:I,className:"btn-secondary flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"יצא PDF"]}),e.jsxs("button",{onClick:C,className:"btn-secondary flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"יצא Excel"]}),e.jsxs("button",{onClick:()=>x(),className:"btn-primary flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"הוסף דייר"]})]})]}),h.length===0?e.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:e.jsx("p",{className:"text-slate-500",children:"לא נמצאו דיירים בבניין זה."})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(s=>e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200/80 p-4 flex flex-col transition-all duration-300 hover:shadow-xl hover:border-sky-300",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800",children:s.name}),s.companyId&&e.jsxs("p",{className:"text-xs text-slate-500",children:["ח.פ: ",s.companyId]}),e.jsxs("div",{className:"mt-3 space-y-2 text-sm text-slate-600",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-slate-400"})," ",e.jsx("a",{href:`tel:${s.phone}`,className:"hover:underline",children:s.phone})]}),e.jsxs("p",{className:"flex items-center gap-2 truncate",children:[e.jsx(F,{className:"w-4 h-4 text-slate-400"})," ",e.jsx("a",{href:`mailto:${s.email}`,className:"hover:underline truncate",children:s.email})]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-slate-400"}),s.floor&&`קומה ${s.floor}, `,s.officeNumber&&`משרד ${s.officeNumber}, `,s.building&&`אגף ${s.building}`]}),s.officeSpace&&e.jsxs("p",{children:[e.jsx("strong",{children:"שטח:"})," ",s.officeSpace]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-slate-100 flex justify-end gap-1",children:[e.jsx("button",{onClick:()=>x(s),className:"p-2 text-slate-500 hover:text-sky-600 hover:bg-sky-100 rounded-full transition-colors",title:"ערוך פרטי דייר",children:e.jsx(L,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>w(s.id),className:"p-2 text-slate-500 hover:text-red-600 hover:bg-red-100 rounded-full transition-colors",title:"מחק דייר",children:e.jsx(O,{className:"w-5 h-5"})})]})]},s.id))}),e.jsx(A,{isOpen:v,onClose:()=>d(!1),title:l?.id?"עריכת דייר":"הוספת דייר חדש",size:"lg",children:l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"שם",value:l.name||"",onChange:s=>n(a=>({...a,name:s.target.value})),className:"input-class"}),e.jsx("input",{type:"tel",placeholder:"טלפון",value:l.phone||"",onChange:s=>n(a=>({...a,phone:s.target.value})),className:"input-class"}),e.jsx("input",{type:"email",placeholder:"אימייל",value:l.email||"",onChange:s=>n(a=>({...a,email:s.target.value})),className:"input-class"}),e.jsx("input",{type:"text",placeholder:"ח.פ",value:l.companyId||"",onChange:s=>n(a=>({...a,companyId:s.target.value})),className:"input-class"}),e.jsx("input",{type:"text",placeholder:"מבנה/אגף",value:l.building||"",onChange:s=>n(a=>({...a,building:s.target.value})),className:"input-class"}),e.jsx("input",{type:"text",placeholder:"קומה",value:l.floor||"",onChange:s=>n(a=>({...a,floor:s.target.value})),className:"input-class"}),e.jsx("input",{type:"text",placeholder:"מספר משרד",value:l.officeNumber||"",onChange:s=>n(a=>({...a,officeNumber:s.target.value})),className:"input-class"}),e.jsx("input",{type:"text",placeholder:"שטח משרד (לדוגמה: 150 מ״ר)",value:l.officeSpace||"",onChange:s=>n(a=>({...a,officeSpace:s.target.value})),className:"input-class"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>d(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:y,className:"btn-primary",children:"שמור"})]})]})}),e.jsx("style",{children:`
                .input-class { display: block; width: 100%; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.5rem 0.75rem; }
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
            `})]})};export{U as default};
