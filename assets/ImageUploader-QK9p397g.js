import{u as T,r as u,j as t,aN as E,p as D,T as C,e as O,aO as M,aP as _,aQ as G}from"./index-D-cHbBwn.js";import{o as P}from"./imageService-DERf2zoE.js";import{A as R}from"./AnnotationEditor-CCeRCJQ5.js";import{a as H}from"./shareUtils-BhFQGnPw.js";const L=({images:r,onImagesChange:o,maxImages:i=5,allowNotes:b=!0,allowSharing:y=!1,shareContextText:g="Check out this image",forceJpegCompression:j=!0})=>{const{addToast:l}=T(),p=u.useRef(null),[m,f]=u.useState(!1),[c,h]=u.useState(null),[v,x]=u.useState(""),w=async e=>{if(!e.target.files)return;const a=Array.from(e.target.files);if(r.length+a.length>i){l(`ניתן להעלות עד ${i} תמונות.`,"warning");return}const n=a.map(d=>P(d,G,_,M,j).then(s=>({id:O(),name:s.name,mimeType:s.mimeType,dataUrl:s.dataUrl,originalDataUrl:s.dataUrl,annotationData:"[]",createdAt:new Date().toISOString(),caption:""})).catch(s=>(console.error("Error optimizing image:",s),l(`שגיאה בעיבוד התמונה ${d.name}`,"error"),null))),S=(await Promise.all(n)).filter(d=>d!==null);o([...r,...S]),p.current&&(p.current.value="")},A=e=>{o(r.filter(a=>a.id!==e))},N=(e,a)=>{o(r.map(n=>n.id===e?{...n,caption:a}:n))},I=e=>{h(e);const a=e.originalUrl||e.originalDataUrl||e.url||e.dataUrl;if(!a){l("שגיאה בטעינת התמונה לעריכה.","error");return}x(a),f(!0)},k=e=>{c&&(o(r.map(a=>a.id===c.id?{...a,dataUrl:e.annotatedDataUrl,annotationData:e.annotationData}:a)),l("הערות תמונה נשמרו","success")),f(!1),h(null)},U=async e=>{const a=e.url||e.dataUrl;if(!a){l("לא נמצאה תמונה לשיתוף.","error");return}try{await H(a,e.name,g)}catch(n){l(n.message,"error")}};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:["תמונות (עד ",i,")"]}),t.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:w,ref:p,className:"block w-full text-sm text-slate-500 file:mr-4 file:rtl:ml-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-sky-50 file:text-sky-700 hover:file:bg-sky-100 disabled:opacity-50",disabled:r.length>=i})]}),r.length>0&&t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:r.map(e=>t.jsxs("div",{className:"border border-slate-200 rounded-lg overflow-hidden shadow bg-white flex flex-col",children:[t.jsxs("div",{className:"relative group",children:[t.jsx("img",{src:e.url||e.dataUrl,alt:e.name,className:"w-full h-32 object-cover"}),t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-opacity flex flex-col items-center justify-center p-1",children:t.jsxs("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex space-x-2 rtl:space-x-reverse",children:[y&&t.jsx("button",{type:"button",onClick:()=>U(e),className:"p-1.5 bg-blue-500 text-white rounded-full hover:bg-blue-600",title:"שתף תמונה",children:t.jsx(E,{className:"w-4 h-4"})}),b&&t.jsx("button",{type:"button",onClick:()=>I(e),className:"p-1.5 bg-sky-500 text-white rounded-full hover:bg-sky-600",title:"ערוך הערות",children:t.jsx(D,{className:"w-4 h-4"})}),t.jsx("button",{type:"button",onClick:()=>A(e.id),className:"p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600",title:"מחק תמונה",children:t.jsx(C,{className:"w-4 h-4"})})]})})]}),t.jsx("div",{className:"p-2",children:t.jsx("input",{type:"text",placeholder:"הוסף כיתוב...",value:e.caption||"",onChange:a=>N(e.id,a.target.value),className:"w-full text-xs border-slate-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500","aria-label":`כיתוב לתמונה ${e.name}`})})]},e.id))}),m&&c&&t.jsx(R,{isOpen:m,onClose:()=>{f(!1),h(null),x("")},onSave:k,imageSrc:v,initialAnnotationData:c.annotationData||"[]"})]})};export{L as I};
