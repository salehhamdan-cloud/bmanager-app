import{r as o,u as S,h as y,g as v,j as e,a as k,A as P,L as D}from"./index-D-cHbBwn.js";import{C}from"./CollapsibleSection-F92uqtdU.js";import{u as L}from"./pdfService-D-0A9fw7.js";import"./dateFormatter-CUKId3Gl.js";const A=r=>{switch(r){case"פעיל":return{bg:"bg-green-100",text:"text-green-800"};case"הושלם":return{bg:"bg-blue-100",text:"text-blue-800"};case"בהמתנה":return{bg:"bg-amber-100",text:"text-amber-800"};case"בוטל":return{bg:"bg-slate-100",text:"text-slate-600"};default:return{bg:"bg-gray-100",text:"text-gray-800"}}},I=r=>r?r.split(" ").map(c=>c[0]).slice(0,2).join("").toUpperCase():"",h=({label:r,value:c,currentSort:g,setSort:u})=>e.jsx("button",{onClick:()=>u(c),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${g===c?"bg-white shadow text-sky-600":"text-slate-600 hover:bg-white/60"}`,children:r}),O=()=>{const[r,c]=o.useState([]),[g,u]=o.useState(!0),{addToast:m}=S(),{settings:p}=y(),[n,x]=o.useState("projectName-asc"),f=o.useCallback(async()=>{u(!0);try{const t=(await v()).flatMap(a=>(a.subProjects||[]).map(l=>({...l,projectId:a.id,projectName:a.name})));c(t)}catch{m("שגיאה בטעינת פרויקטי משנה","error")}finally{u(!1)}},[m]);o.useEffect(()=>{f()},[f]);const w=()=>{if(j.length===0){m("אין פרויקטים לייצוא","warning");return}m("מכין PDF...","info"),L({settings:p,subProjects:j})},j=o.useMemo(()=>[...r].sort((s,t)=>{const[a,l]=n.split("-");let i,d;switch(a){case"name":i=s.name.toLowerCase(),d=t.name.toLowerCase();break;case"status":i=s.status,d=t.status;break;case"workStartDate":i=s.workStartDate?new Date(s.workStartDate).getTime():0,d=t.workStartDate?new Date(t.workStartDate).getTime():0;break;case"projectName":default:i=s.projectName.toLowerCase(),d=t.projectName.toLowerCase();break}return i<d?l==="asc"?-1:1:i>d?l==="asc"?1:-1:s.projectName.localeCompare(t.projectName)}),[r,n]),b=o.useMemo(()=>j.reduce((s,t)=>(s[t.projectName]||(s[t.projectName]=[]),s[t.projectName].push(t),s),{}),[j]),N=o.useMemo(()=>Object.keys(b),[b]);return g?e.jsx(k,{text:"טוען פרויקטים..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"כל פרויקטי המשנה"}),e.jsxs("button",{onClick:w,className:"btn-secondary flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"יצא PDF"]})]}),e.jsxs("div",{className:"bg-white p-2 rounded-lg shadow-md border flex flex-wrap items-center gap-1",children:[e.jsx(h,{label:"בניין (א-ת)",value:"projectName-asc",currentSort:n,setSort:x}),e.jsx(h,{label:"שם (א-ת)",value:"name-asc",currentSort:n,setSort:x}),e.jsx(h,{label:"תאריך התחלה",value:"workStartDate-asc",currentSort:n,setSort:x}),e.jsx(h,{label:"סטטוס",value:"status-asc",currentSort:n,setSort:x})]}),r.length===0?e.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:e.jsx("p",{className:"text-slate-500",children:"לא נמצאו פרויקטי משנה."})}):e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsx(C,{title:e.jsx("h2",{className:"text-xl font-semibold text-slate-700",children:s}),count:b[s].length,children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b[s].map(t=>{const a=A(t.status),l=t.coverPhoto?.url||t.coverPhoto?.dataUrl;return e.jsxs(D,{to:`/project/${t.projectId}/sub-project/${t.id}`,className:"bg-white rounded-xl shadow-md border border-slate-200/80 overflow-hidden flex flex-col transition-all duration-300 hover:shadow-lg hover:border-sky-200",children:[e.jsxs("div",{className:"h-40 bg-slate-200 flex items-center justify-center relative group",children:[l?e.jsx("img",{src:l,alt:t.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-4xl font-bold text-slate-400",children:I(t.name)}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:"צפה בפרטים"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 truncate",title:t.name,children:t.name}),e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded-full self-start whitespace-nowrap ${a.bg} ${a.text}`,children:t.status})]}),e.jsx("p",{className:"text-sm text-slate-500 line-clamp-2 h-10",children:t.description})]})]},t.id)})})},s))}),e.jsx("style",{children:".btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }"})]})};export{O as default};
