import{B as j,u as y,h as v,r as n,g as C,j as a,a as L,A as x,s as E,L as I,ap as k}from"./index-BU7E-q7q.js";import{f as D}from"./pdfService-Th-ePIZW.js";import{e as P}from"./exportUtils-Bak1EFUX.js";import{f as T}from"./dateFormatter-CUKId3Gl.js";import{N as A}from"./NavigationCard-BEYIEqZA.js";const O=()=>{j();const{addToast:t}=y(),{settings:m}=v(),[c,h]=n.useState([]),[p,u]=n.useState(!0),[l,f]=n.useState(""),g=n.useCallback(async()=>{u(!0);try{const e=await C(),s=[];(e||[]).forEach(r=>{(r.inventory||[]).forEach(d=>{(d.itemGroups||[]).forEach(i=>{(i.items||[]).forEach(w=>{s.push({...w,buildingId:r.id,buildingName:r.name,locationId:d.id,locationName:d.name,groupId:i.id,groupName:i.name})})})})}),h(s)}catch{t("שגיאה בטעינת פריטי המלאי","error")}finally{u(!1)}},[t]);n.useEffect(()=>{g()},[g]);const o=n.useMemo(()=>{if(!l)return c.sort((s,r)=>s.name.localeCompare(r.name,"he"));const e=l.toLowerCase();return c.filter(s=>s.name.toLowerCase().includes(e)||s.description.toLowerCase().includes(e)||s.model.toLowerCase().includes(e)||s.company.toLowerCase().includes(e)||s.locationName.toLowerCase().includes(e)||s.groupName.toLowerCase().includes(e)||s.buildingName.toLowerCase().includes(e)).sort((s,r)=>s.name.localeCompare(r.name,"he"))},[c,l]),N=()=>{if(o.length===0){t("אין פריטים לייצוא","warning");return}t("מכין PDF...","info"),D({settings:m,items:o})},b=()=>{if(o.length===0){t("אין פריטים לייצוא","warning");return}const e=o.map(s=>({בניין:s.buildingName,מיקום:s.locationName,קבוצה:s.groupName,"שם פריט":s.name,חברה:s.company,דגם:s.model,כמות:s.quantity,"תאריך סיום אחריות":s.warrantyEndDate?T(s.warrantyEndDate):"-","מידע אחריות":s.warrantyInfo||""}));P(e,"all_inventory_list"),t("קובץ Excel יוצא...","success")};return p?a.jsx(L,{text:"טוען את כל פריטי המלאי..."}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[a.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"כל פריטי המלאי"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:N,className:"btn-secondary flex items-center gap-2",children:[a.jsx(x,{className:"w-5 h-5"}),"יצא PDF"]}),a.jsxs("button",{onClick:b,className:"btn-secondary flex items-center gap-2",children:[a.jsx(x,{className:"w-5 h-5"}),"יצא Excel"]})]})]}),a.jsx(A,{to:"/order-list",icon:a.jsx(E,{className:"w-6 h-6"}),title:"פריטים להזמנה",count:m.inventoryOrderList?.length||0}),a.jsx("div",{className:"sticky top-[72px] bg-slate-50/80 backdrop-blur-sm z-10 py-2",children:a.jsx("input",{type:"search",placeholder:`חיפוש ב-${c.length} פריטים...`,value:l,onChange:e=>f(e.target.value),className:"input-class w-full"})}),o.length===0?a.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:a.jsx("p",{className:"text-slate-500",children:l?"לא נמצאו פריטים תואמים לחיפוש.":"לא קיימים פריטים במלאי."})}):a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:o.map(e=>a.jsxs(I,{to:`/project/${e.buildingId}/inventory/location/${e.locationId}/group/${e.groupId}`,className:"bg-white rounded-lg shadow border overflow-hidden group flex flex-col transition-all duration-300 hover:shadow-xl hover:-translate-y-1",title:`${e.buildingName} > ${e.locationName} > ${e.groupName}`,children:[a.jsxs("div",{className:"relative",children:[a.jsx("img",{src:e.images.length>0?e.images[0].url||e.images[0].dataUrl:k,alt:e.name,className:"w-full h-32 object-cover transition-transform duration-300 group-hover:scale-105"}),a.jsx("div",{className:"absolute top-1 right-1 bg-sky-600 text-white text-xs font-bold rounded-full w-7 h-7 flex items-center justify-center shadow-md",children:e.quantity})]}),a.jsxs("div",{className:"p-3 flex-grow flex flex-col",children:[a.jsx("h3",{className:"font-semibold text-slate-800 text-sm leading-tight truncate",children:e.name}),a.jsx("p",{className:"text-xs text-slate-500 mt-1 truncate font-medium",children:e.buildingName}),a.jsxs("p",{className:"text-xs text-slate-500 mt-1 truncate",children:[e.locationName," > ",e.groupName]})]})]},e.id))}),a.jsx("style",{children:`
                .input-class { display: block; width: 100%; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.5rem 0.75rem; }
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
            `})]})};export{O as default};
