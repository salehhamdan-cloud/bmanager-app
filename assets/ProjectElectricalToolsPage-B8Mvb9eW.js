import{k as N,B as k,u as y,h as v,r as l,l as S,j as e,a as P,L as C,A as D,ad as T,$ as E,z as $}from"./index-D-cHbBwn.js";import{f as I}from"./dateFormatter-CUKId3Gl.js";import{s as L}from"./pdfService-D-0A9fw7.js";const F=()=>{const{projectId:d}=N(),m=k(),{addToast:r}=y(),{settings:j}=v(),[c,h]=l.useState(null),[o,u]=l.useState([]),[b,g]=l.useState(!0),i=l.useCallback(async()=>{if(d){g(!0);try{const s=await S(d);if(s){h(s);const n=s.inventory?.flatMap(t=>t.itemGroups).find(t=>t.name==="כלי עבודה חשמליים")?.items||[];u(n)}else r("בניין לא נמצא","error"),m("/")}catch{r("שגיאה בטעינת כלים","error")}finally{g(!1)}}},[d,r,m]);l.useEffect(()=>{i()},[i]);const p=async(s,n)=>{if(!c)return;const t=o.map(a=>a.id===s?{...a,checkStatus:n,lastCheckedDate:new Date().toISOString()}:a),f={...c,inventory:(c.inventory||[]).map(a=>({...a,itemGroups:a.itemGroups.map(x=>x.name==="כלי עבודה חשמליים"?{...x,items:t}:x)})),updatedAt:new Date().toISOString()};u(t),h(f);try{await $(f),r(`'${t.find(a=>a.id===s)?.name}' סומן כ'${n}'`,"success")}catch{r("שגיאה בעדכון סטטוס","error"),i()}},w=()=>{if(!c||o.length===0){r("אין כלים לייצוא","warning");return}r("מכין PDF...","info"),L({settings:j,project:c,items:o})};return b?e.jsx(P,{text:"טוען כלי עבודה..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("nav",{className:"text-sm mb-1",children:e.jsx(C,{to:`/project/${d}`,className:"text-sky-600 hover:underline",children:"חזרה לבניין"})}),e.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["בדיקת כלי עבודה חשמליים: ",c?.name]})]}),e.jsxs("button",{onClick:w,className:"btn-secondary flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"יצא PDF"]})]}),o.length===0?e.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:e.jsx("p",{className:"text-slate-500",children:'לא נמצאו פריטים בקבוצת "כלי עבודה חשמליים" במלאי הבניין.'})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(s=>{const n=s.checkStatus==="תקין",t=s.checkStatus==="דורש תיקון";return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border flex items-center gap-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold text-slate-800",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.company," ",s.model]}),s.lastCheckedDate&&e.jsxs("p",{className:`text-xs mt-1 font-medium ${n?"text-green-600":t?"text-red-600":"text-slate-500"}`,children:["נבדק לאחרונה: ",I(s.lastCheckedDate)," - ",s.checkStatus]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>p(s.id,"תקין"),className:`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-1.5 transition-colors ${n?"bg-green-600 text-white shadow":"bg-green-100 text-green-800 hover:bg-green-200"}`,children:[e.jsx(T,{className:"w-4 h-4"})," תקין"]}),e.jsxs("button",{onClick:()=>p(s.id,"דורש תיקון"),className:`px-3 py-1.5 rounded-md text-sm font-medium flex items-center gap-1.5 transition-colors ${t?"bg-red-600 text-white shadow":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:[e.jsx(E,{className:"w-4 h-4"})," דורש תיקון"]})]})]},s.id)})}),e.jsx("style",{children:".btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }"})]})};export{F as default};
