import{k as S,B as D,r as a,u as E,h as C,l as A,j as r,a as L,L as M,A as O,P as F,a_ as T,e as z,z as B}from"./index-D-cHbBwn.js";import{W as R,a as V,A as _}from"./WorkerDetailsModal-BtMYlDHh.js";import{p as $}from"./pdfService-D-0A9fw7.js";import"./ImageUploader-QK9p397g.js";import"./imageService-DERf2zoE.js";import"./AnnotationEditor-CCeRCJQ5.js";import"./shareUtils-BhFQGnPw.js";import"./ContactIcons-B1NAvYGF.js";import"./dateFormatter-CUKId3Gl.js";const Z=()=>{const{projectId:n}=S(),p=D(),[e,h]=a.useState(null),[k,u]=a.useState(!0),{addToast:t}=E(),{settings:w}=C(),[b,d]=a.useState(!1),[y,j]=a.useState(null),[l,g]=a.useState(null),c=a.useCallback(async()=>{if(n){u(!0);try{const s=await A(n);s?h(s):(t("בניין לא נמצא","error"),p("/"))}catch{t("שגיאה בטעינת עובדים","error")}finally{u(!1)}}},[n,t,p]);a.useEffect(()=>{c()},[c]);const x=(s=null)=>{j(s?{...s}:{}),d(!0)},N=async s=>{if(!s.name?.trim()||!e){t("שם העובד הוא שדה חובה","warning");return}const{projectId:v,...i}=s;let m;if(i.id)m=(e.workers||[]).map(o=>o.id===i.id?{...o,...i}:o);else{const o={id:z(),...i};m=[...e.workers||[],o]}const I={...e,workers:m,updatedAt:new Date().toISOString()};try{await B(I),t("העובד נשמר","success"),d(!1),j(null),c()}catch{t("שגיאה בשמירת העובד","error")}},P=async s=>{if(!(!e||!window.confirm("האם למחוק עובד זה?")))try{await T(e.id,s),t("העובד נמחק","success"),c()}catch{t("שגיאה במחיקת העובד","error")}},W=()=>{if(!e||!e.workers||e.workers.length===0){t("אין עובדים לייצוא","warning");return}t("מכין PDF...","info"),$({settings:w,project:e,workers:e.workers})};if(k)return r.jsx(L,{text:"טוען עובדים..."});const f=e?.workers||[];return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx("nav",{className:"text-sm mb-1",children:r.jsx(M,{to:`/project/${n}`,className:"text-sky-600 hover:underline",children:"חזרה לבניין"})}),r.jsxs("h2",{className:"text-2xl font-semibold text-slate-700",children:["עובדי תחזוקה: ",e?.name]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("button",{onClick:W,className:"btn-secondary flex items-center gap-2",children:[r.jsx(O,{className:"w-5 h-5"}),"יצא PDF"]}),r.jsxs("button",{onClick:()=>x(),className:"btn-primary flex items-center gap-2",children:[r.jsx(F,{className:"w-5 h-5"}),"הוסף עובד"]})]})]}),f.length===0?r.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:r.jsx("p",{className:"text-slate-500",children:"לא נמצאו עובדים בבניין זה."})}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(s=>r.jsx(R,{worker:{...s,projectId:e.id,projectName:e.name},onSelect:()=>g(s),onEdit:()=>x(s),onDelete:()=>P(s.id)},s.id))}),r.jsx(V,{isOpen:!!l,onClose:()=>g(null),worker:l?{...l,projectId:e.id,projectName:e.name}:null}),r.jsx(_,{isOpen:b,onClose:()=>d(!1),onSave:N,worker:y,projects:e?[e]:[]}),r.jsx("style",{children:`
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
            `})]})};export{Z as default};
