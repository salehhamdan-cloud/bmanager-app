import{r as n,u as ot,h as ct,aC as dt,n as ut,g as pt,aD as N,j as e,a as Ae,A as Oe,p as Te,P as mt,aE as K,aF as xt,T as Ee,M as V,aG as gt,aH as Me,e as Be,aI as Qe,aJ as Ve,aK as ht,aL as ft}from"./index-D-cHbBwn.js";import{f as ie}from"./dateFormatter-CUKId3Gl.js";import{C as oe}from"./CollapsibleSection-F92uqtdU.js";import{n as jt}from"./pdfService-D-0A9fw7.js";import{e as bt}from"./exportUtils-Bak1EFUX.js";import{S as Nt,f as vt}from"./aiService-BGt51fXt.js";import{c as yt}from"./pdfUtils-CkvU2BMR.js";import{C as de,r as wt}from"./chart-Zj-L_LRF.js";de.register(...wt);const j=({label:c,value:y,currentValue:w,onClick:D})=>e.jsx("button",{onClick:()=>D(y),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${w===y?"bg-sky-600 text-white shadow":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,children:c}),ce=({title:c,options:y,selected:w,onToggle:D,onToggleAll:g})=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-600",children:[c,":"]}),e.jsx("button",{onClick:g,className:"text-xs text-sky-600 hover:underline",children:w.size===y.length?"בטל הכל":"בחר הכל"})]}),e.jsx("div",{className:"max-h-32 overflow-y-auto border rounded-md p-2 space-y-1 bg-white",children:y.map(C=>e.jsxs("label",{className:"flex items-center gap-2 p-1 hover:bg-slate-100 rounded",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox",checked:w.has(C),onChange:()=>D(C)}),C]},C))})]}),Ot=()=>{const[c,y]=n.useState([]),[w,D]=n.useState([]),[g,C]=n.useState([]),[$e,$]=n.useState(!0),{addToast:u}=ot(),{settings:Re}=ct(),[Ue,R]=n.useState(!1),[i,h]=n.useState(null),[ze,ue]=n.useState(!1),[p,Le]=n.useState(null),[_e,W]=n.useState(!1),[U,pe]=n.useState(null),[Ge,z]=n.useState(!1),[f,H]=n.useState({buildings:new Set,years:new Set,groups:new Set,status:"all"}),[J,me]=n.useState(null),[xe,ge]=n.useState(null),[Ye,he]=n.useState(!1),Ke=n.useRef(null),[We,X]=n.useState(!1),[I,fe]=n.useState("all"),[A,je]=n.useState("all"),[O,be]=n.useState("all"),[S,T]=n.useState("date-desc"),[b,He]=n.useState(!1),[E,Z]=n.useState({}),P=Object.keys(E).length,[L,Je]=n.useState(null),Ne=n.useRef(null),ve=n.useRef(null);n.useEffect(()=>{b||Z({})},[b]);const k=n.useCallback(async()=>{$(!0);try{const[t,s,a]=await Promise.all([dt(),ut(),pt()]),l=t.filter(m=>!m.subProjectId),r=[];for(const m of l){let d={...m};if(d.projectName=String(d.projectName||"לא שויך"),typeof d.price!="number"||isNaN(d.price)){const x=d.price,v=parseFloat(String(x).replace(/[^\d.-]/g,""));d.price=isNaN(v)?0:v}r.push(d)}y(r),D(s),C(a)}catch(t){u("שגיאה בטעינת נתונים","error"),console.error("Data loading/sanitization failed:",t)}finally{$(!1)}},[u]);n.useEffect(()=>{k()},[k]);const ye=n.useMemo(()=>c.filter(t=>{const s=new Date(t.date).getFullYear().toString();return(I==="all"||t.projectName===I)&&(A==="all"||s===A)&&(O==="all"||t.group===O)}),[c,I,A,O]),M=n.useMemo(()=>[...ye].sort((t,s)=>{switch(S){case"date-asc":return new Date(t.date).getTime()-new Date(s.date).getTime();case"price-desc":return s.price-t.price;case"price-asc":return t.price-s.price;case"supplier-asc":return t.supplierName.localeCompare(s.supplierName);case"date-desc":default:return new Date(s.date).getTime()-new Date(t.date).getTime()}}),[ye,S]),q=n.useMemo(()=>{const t={};return M.forEach(s=>{const a=String(s.projectName||"לא שויך");t[a]||(t[a]=[]),t[a].push(s)}),t},[M]),we=n.useMemo(()=>Object.keys(q).sort((t,s)=>t.localeCompare(s,"he")),[q]),Se=n.useMemo(()=>{const t={totalCostAll:0,costByYear:{},costByGroup:{},costByBuilding:{}},s=[N.APPROVED,N.WORK_COMPLETED,N.INVOICE_PAID];return M.filter(a=>s.includes(a.status)).forEach(a=>{const l=Number(a.price)||0,r=new Date(a.date).getFullYear().toString(),m=a.group||"ללא תחום";t.totalCostAll+=l,t.costByYear[r]=(t.costByYear[r]||0)+l,t.costByGroup[m]=(t.costByGroup[m]||0)+l,t.costByBuilding[a.projectName]=(t.costByBuilding[a.projectName]||0)+l}),t},[M]);n.useEffect(()=>{Je(Se)},[Se]);const Ce=(t,s,a,l="bar")=>{if(!t.current||!s)return null;const r=de.getChart(t.current);r&&r.destroy();const m=t.current.getContext("2d");if(!m)return null;const d=Object.keys(s),x=Object.values(s);return new de(m,{type:l,data:{labels:d,datasets:[{label:a,data:x,backgroundColor:l==="bar"?"rgba(59, 130, 246, 0.5)":d.map((v,B)=>`hsl(${B*(360/d.length)}, 70%, 80%)`),borderColor:l==="bar"?"rgba(59, 130, 246, 1)":d.map((v,B)=>`hsl(${B*(360/d.length)}, 70%, 60%)`),borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:l==="pie"}}}})};n.useEffect(()=>{const t=Ce(Ne,L?.costByYear||{},'סה"כ הוצאות לפי שנה'),s=Ce(ve,L?.costByGroup||{},'סה"כ הוצאות לפי תחום',"pie");return()=>{t?.destroy(),s?.destroy()}},[L]);const Pe=(t=null)=>{h(t?{...t}:{date:new Date().toISOString().split("T")[0],status:N.PENDING,projectId:g.length===1?g[0].id:"",projectName:g.length===1?g[0].name??"":"",subProjectId:"",subProjectName:""}),me(null),ge(null),R(!0)},Xe=async t=>{if(window.confirm("האם למחוק הצעת מחיר זו?"))try{await ht(t),u("הצעת המחיר נמחקה","success"),k()}catch{u("שגיאה במחיקת הצעת המחיר","error")}},ke=(t,s)=>{const a=t.target.files?.[0];if(a){if(a.type!=="application/pdf"){u("יש לבחור קובץ PDF בלבד","warning"),t.target.value="";return}s==="quotation"?me(a):ge(a)}},Ze=async()=>{if(!i||!i.supplierName||!i.quotationName||!i.projectName||!i.group||i.price===void 0){u("נא למלא את כל שדות החובה (*)","warning");return}if(!i.id&&!J){u("יש לצרף קובץ PDF של הצעת המחיר","warning");return}$(!0);try{const t=async r=>r?new Promise((m,d)=>{const x=new FileReader;x.onload=v=>m({name:r.name,dataUrl:v.target?.result,mimeType:r.type}),x.onerror=d,x.readAsDataURL(r)}):null,[s,a]=await Promise.all([t(J),t(xe)]);let l={...i};s&&(l.pdfFile=s),a&&(l.invoicePdfFile=a),i.id?(l.updatedAt=new Date().toISOString(),await Ve(l),u("הצעת המחיר עודכנה","success")):(l.id=Be(),l.createdAt=new Date().toISOString(),l.updatedAt=new Date().toISOString(),await Qe(l),u("הצעת מחיר חדשה נוספה","success")),R(!1),h(null),k()}catch{u("שגיאה בשמירת הצעת המחיר","error")}finally{$(!1)}},qe=()=>{X(!0)},Fe=async t=>{const s=t.target.files?.[0];if(s){X(!1),he(!0);try{let a="";if(s.type==="application/pdf"){const o=await new Promise((G,Y)=>{const F=new FileReader;F.onload=Q=>G(Q.target?.result),F.onerror=Q=>Y(Q),F.readAsDataURL(s)});a=await yt(o)}else if(s.type==="text/csv"||s.name.endsWith(".csv"))a=await s.text();else throw new Error("סוג קובץ לא נתמך. יש להעלות PDF או CSV.");const l=await vt(a);if(l.length===0){u("לא זוהו הצעות מחיר תקינות בקובץ.","warning");return}const r=new Map(g.map(o=>[o.name,o.id])),m=[],d=[];let x=0;for(const o of l){const G=c.find(ne=>ne.quotationNumber&&o.quotationNumber&&ne.quotationNumber!=="-"&&ne.quotationNumber===o.quotationNumber),Y=parseFloat(String(o.price??"0").replace(/[^\d.-]/g,"")),F=String(o.projectName||"לא שויך"),Q=r.get(F)||"unassigned",Ie={date:o.date&&typeof o.date=="string"&&o.date?new Date(o.date).toISOString():new Date().toISOString(),supplierName:o.supplierName??"לא צוין",quotationNumber:o.quotationNumber??"-",quotationName:o.quotationName??"לא צוין",group:o.group??"כללי",price:isNaN(Y)?0:Y,projectId:Q,projectName:F,status:o.status||N.PENDING,updatedAt:new Date().toISOString()};if(G)window.confirm(`הצעת מחיר עם מספר "${String(o.quotationNumber)}" עבור "${String(o.quotationName)}" כבר קיימת. האם להחליף אותה בפרטים החדשים?`)?d.push({...G,...Ie}):x++;else{if(!o.quotationName)continue;m.push({...Ie,id:Be(),createdAt:new Date().toISOString(),pdfFile:{name:"נדרשת העלאה.pdf",mimeType:"application/pdf"}})}}if(m.length===0&&d.length===0){u(`היבוא בוטל. ${x>0?`${x} הצעות מחיר קיימות לא עודכנו.`:""}`,"info");return}const v=m.map(o=>Qe(o)),B=d.map(o=>Ve(o));await Promise.all([...v,...B]);let _="";m.length>0&&(_+=`${m.length} הצעות חדשות נוספו. `),d.length>0&&(_+=`${d.length} הצעות קיימות עודכנו. `),x>0&&(_+=`${x} הצעות מחיר לא שונו.`),u(_.trim(),"success"),k()}catch(a){u(a instanceof Error?a.message:"שגיאה ביבוא","error")}finally{he(!1),t.target&&(t.target.value="")}}},De=t=>{Z(s=>{const a={...s};return a[t]?delete a[t]:a[t]=!0,a})},et=async()=>{if(P!==0&&window.confirm(`האם למחוק ${P} הצעות מחיר נבחרות?`)){const t=Object.keys(E);try{await ft(t),u(`${P} הצעות מחיר נמחקו`,"success"),Z({}),k()}catch{u("שגיאה במחיקת הצעות מחיר","error")}}},tt=()=>{const t=b&&P>0?c.filter(a=>E[a.id]):M;if(t.length===0){u("לא נבחרו הצעות מחיר לייצוא","warning");return}const s=t.map(a=>({בניין:a.projectName,"פרויקט משנה":a.subProjectName||"",תחום:a.group,"שם הצעה":a.quotationName,ספק:a.supplierName,"תאריך אישור":ie(a.date),"מס' הצעה":a.quotationNumber,"מס' חשבונית":a.invoiceNumber||"",מחיר:a.price,סטטוס:a.status,שולם:a.status===N.INVOICE_PAID?"כן":"לא"}));bt(s,"quotations_list")},st=n.useMemo(()=>Array.from(new Set(c.map(t=>new Date(t.date).getFullYear().toString()))).sort((t,s)=>parseInt(s)-parseInt(t)),[c]),at=n.useMemo(()=>{const t=new Set(c.map(s=>s.projectName));return Array.from(t).filter(s=>!!s).sort((s,a)=>s.localeCompare(a,"he"))},[c]),lt=n.useMemo(()=>Array.from(new Set(c.map(t=>t.group).filter(t=>!!t))).sort((t,s)=>t.localeCompare(s,"he")),[c]),rt=Array.from(new Set(w.map(t=>t.group)));n.useMemo(()=>i?.projectId?g.find(t=>t.id===i.projectId):null,[i?.projectId,g]);const ee=n.useMemo(()=>{const t=new Set(c.map(s=>new Date(s.date).getFullYear().toString()));return Array.from(t).sort((s,a)=>parseInt(a)-parseInt(s))},[c]),te=n.useMemo(()=>{const t=new Set(c.map(s=>s.group).filter(s=>!!s));return Array.from(t).sort((s,a)=>s.localeCompare(a,"he"))},[c]),se=n.useMemo(()=>{const t=new Set(c.map(s=>s.projectName).filter(s=>!!s));return Array.from(t).sort((s,a)=>s.localeCompare(a,"he"))},[c]),ae=n.useMemo(()=>{const t=[N.APPROVED,N.WORK_COMPLETED,N.INVOICE_PAID];return c.filter(s=>{const a=new Date(s.date).getFullYear().toString(),l=f.buildings.size===0||f.buildings.has(s.projectName),r=f.years.size===0||f.years.has(a),m=f.groups.size===0||f.groups.has(s.group),d=(()=>{switch(f.status){case"approved":return t.includes(s.status);case"paid":return s.status===N.INVOICE_PAID;default:return!0}})();return l&&r&&m&&d})},[c,f]),nt=()=>{if(c.length===0){u("אין הצעות מחיר לייצוא","warning");return}H({buildings:new Set(se),years:new Set(ee),groups:new Set(te),status:"all"}),z(!0)},it=()=>{const t=ae;if(t.length===0){u("לא נמצאו הצעות מחיר התואמות לסינון לייצוא","warning");return}const s=t.reduce((a,l)=>{const r=l.projectName||"לא שויך";return a[r]||(a[r]={groups:{},total:0}),a[r].groups[l.group]||(a[r].groups[l.group]=[]),a[r].groups[l.group].push(l),a[r].total+=Number(l.price)||0,a},{});u("מכין PDF...","info");try{jt({settings:Re,quotationsByBuilding:s})}catch(a){u("שגיאה ביצירת PDF","error"),console.error("PDF generation failed:",a)}z(!1)},le=(t,s)=>{H(a=>{const l=new Set(a[t]);return l.has(s)?l.delete(s):l.add(s),{...a,[t]:l}})},re=(t,s)=>{H(a=>a[t].size===s.length?{...a,[t]:new Set}:{...a,[t]:new Set(s)})};return $e?e.jsx(Ae,{text:"טוען הצעות מחיר..."}):e.jsxs("div",{className:"space-y-6",children:[Ye&&e.jsx("div",{className:"fixed inset-0 bg-slate-900 bg-opacity-60 backdrop-blur-sm z-[1001] flex items-center justify-center",children:e.jsx(Ae,{text:"מעבד קובץ בעזרת AI..."})}),e.jsx("input",{type:"file",ref:Ke,onChange:Fe,accept:"application/pdf,text/csv,.csv",className:"hidden"}),e.jsxs(oe,{title:"לוח בקרה (Dashboard)",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"text-lg text-slate-600",children:'סה"כ הוצאות (לפי סינון)'}),e.jsxs("p",{className:"text-4xl font-bold text-sky-700",children:["₪",(L?.totalCostAll??0).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 min-h-[16rem]",children:[e.jsx("div",{className:"bg-slate-50 p-2 rounded-lg",children:e.jsx("canvas",{ref:Ne})}),e.jsx("div",{className:"bg-slate-50 p-2 rounded-lg",children:e.jsx("canvas",{ref:ve})})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"רשימת הצעות מחיר"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("button",{onClick:nt,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(Oe,{className:"w-4 h-4"}),"PDF"]}),e.jsxs("button",{onClick:tt,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Excel"]}),e.jsxs("button",{onClick:qe,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(Nt,{className:"w-5 h-5 text-purple-600"}),"יבא (AI)"]}),e.jsxs("button",{onClick:()=>He(!b),className:`btn-secondary text-sm flex items-center gap-2 ${b?"bg-sky-100 text-sky-700 ring-2 ring-sky-200":""}`,children:[e.jsx(Te,{className:"w-4 h-4"})," ",b?"סיום":"ערוך"]}),e.jsxs("button",{onClick:()=>Pe(),className:"btn-primary flex items-center gap-2 text-sm",children:[e.jsx(mt,{className:"w-5 h-5"}),"הוסף הצעה"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"סנן לפי בניין:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(j,{label:"כל הבניינים",value:"all",currentValue:I,onClick:fe}),at.map(t=>e.jsx(j,{label:t,value:t,currentValue:I,onClick:fe},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"סנן לפי שנה:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(j,{label:"כל השנים",value:"all",currentValue:A,onClick:je}),st.map(t=>e.jsx(j,{label:t,value:t,currentValue:A,onClick:je},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"סנן לפי תחום:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(j,{label:"כל התחומים",value:"all",currentValue:O,onClick:be}),lt.map(t=>e.jsx(j,{label:t,value:t,currentValue:O,onClick:be},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-2",children:"מיין לפי:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(j,{label:"תאריך (חדש לישן)",value:"date-desc",currentValue:S,onClick:T}),e.jsx(j,{label:"תאריך (ישן לחדש)",value:"date-asc",currentValue:S,onClick:T}),e.jsx(j,{label:"מחיר (גבוה לנמוך)",value:"price-desc",currentValue:S,onClick:T}),e.jsx(j,{label:"מחיר (נמוך לגבוה)",value:"price-asc",currentValue:S,onClick:T}),e.jsx(j,{label:"ספק (א-ת)",value:"supplier-asc",currentValue:S,onClick:T})]})]})]}),e.jsx("div",{className:"space-y-4",children:we.length===0?e.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:e.jsx("p",{className:"text-slate-500",children:"לא נמצאו הצעות מחיר התואמות לסינון."})}):we.map(t=>{const s=q[t];return e.jsx(oe,{title:e.jsx("h3",{className:"text-lg font-semibold",children:t}),count:s.length,variant:"primary",children:e.jsx("div",{className:"space-y-4",children:Object.entries(s.reduce((a,l)=>{const r=l.group||"ללא תחום";return a[r]||(a[r]=[]),a[r].push(l),a},{})).sort(([a],[l])=>a.localeCompare(l,"he")).map(([a,l])=>e.jsx(oe,{title:e.jsx("h4",{className:"font-semibold",children:a}),count:l.length,variant:"secondary",children:e.jsx("div",{className:"space-y-3",children:l.map(r=>e.jsxs("div",{className:`bg-white p-3 rounded-lg shadow-sm border flex flex-col sm:flex-row sm:items-center gap-4 mb-2 transition-all duration-200 ${b?"cursor-pointer":""} ${E[r.id]?"bg-sky-50 border-sky-300 ring-2 ring-sky-200":"hover:shadow-md"}`,onClick:b?()=>De(r.id):void 0,children:[b&&e.jsx("input",{type:"checkbox",className:"form-checkbox h-5 w-5 rounded text-sky-600 focus:ring-sky-500 flex-shrink-0",checked:!!E[r.id],onChange:()=>De(r.id),onClick:m=>m.stopPropagation()}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-bold text-slate-800",children:r.quotationName}),e.jsxs("p",{className:"text-sm text-slate-500",children:[r.supplierName," • ",r.subProjectName?`${r.subProjectName} • `:""," ",ie(r.date)]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-lg font-bold text-sky-700",children:["₪",r.price.toLocaleString()]}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full ${K[r.status].bg} ${K[r.status].text}`,children:r.status})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{Le(r),ue(!0)},className:"p-2 text-slate-500 hover:bg-slate-100 rounded-full",title:"הצג פרטים",children:e.jsx(xt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Pe(r),className:"p-2 text-slate-500 hover:bg-slate-100 rounded-full",title:"ערוך",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Xe(r.id),className:"p-2 text-slate-500 hover:bg-red-100 rounded-full",title:"מחק",children:e.jsx(Ee,{className:"w-5 h-5"})})]})]},r.id))})},a))})},t)})}),b&&P>0&&e.jsxs("div",{className:"fixed bottom-24 inset-x-4 z-40 bg-slate-800 text-white rounded-lg shadow-lg p-4 flex justify-between items-center animate-fadeInUp",children:[e.jsxs("span",{children:[P," הצעות מחיר נבחרו"]}),e.jsxs("button",{onClick:et,className:"flex items-center gap-2 px-3 py-1.5 bg-red-500 hover:bg-red-600 rounded-md text-sm font-medium",children:[e.jsx(Ee,{className:"w-5 h-5"})," מחק נבחרים"]})]}),e.jsx(V,{isOpen:Ue,onClose:()=>R(!1),title:i?.id?"עריכת הצעת מחיר":"הוספת הצעת מחיר",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"בניין*"}),e.jsxs("select",{value:i?.projectId||"",onChange:t=>{const s=g.find(a=>a.id===t.target.value);h(a=>({...a,projectId:s?.id,projectName:s?.name,subProjectId:"",subProjectName:""}))},className:"input-class w-full",children:[e.jsx("option",{value:"",disabled:!0,children:"בחר בניין..."}),g.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"תאריך*"}),e.jsx("input",{type:"date",value:i?.date?.split("T")[0]||"",onChange:t=>h(s=>({...s,date:t.target.value})),className:"input-class w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"שם הספק*"}),e.jsx("input",{type:"text",list:"suppliers-list",value:i?.supplierName||"",onChange:t=>h(s=>({...s,supplierName:t.target.value})),className:"input-class w-full"}),e.jsx("datalist",{id:"suppliers-list",children:Array.from(new Set(w.map(t=>t.name))).map(t=>e.jsx("option",{value:t},t))})]})]}),e.jsx("input",{type:"text",placeholder:"שם/תיאור הצעת המחיר*",value:i?.quotationName||"",onChange:t=>h(s=>({...s,quotationName:t.target.value})),className:"input-class w-full"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"מספר הצעה",value:i?.quotationNumber||"",onChange:t=>h(s=>({...s,quotationNumber:t.target.value})),className:"input-class"}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"תחום*"}),e.jsx("input",{type:"text",list:"groups-list",value:i?.group||"",onChange:t=>h(s=>({...s,group:t.target.value})),className:"input-class w-full"}),e.jsx("datalist",{id:"groups-list",children:rt.map(t=>e.jsx("option",{value:t},t))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"מחיר (₪)*"}),e.jsx("input",{type:"number",step:"0.01",value:i?.price??"",onChange:t=>h(s=>({...s,price:parseFloat(t.target.value)})),className:"input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"סטטוס"}),e.jsx("select",{value:i?.status||"",onChange:t=>h(s=>({...s,status:t.target.value})),className:"input-class w-full",children:gt.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"קובץ הצעת מחיר (PDF)*"}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:t=>ke(t,"quotation"),className:"file-input-class"}),i?.pdfFile&&!J&&e.jsxs("p",{className:"text-xs mt-1",children:["קובץ נוכחי: ",i.pdfFile.name]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-md font-medium text-slate-800 mb-2",children:"פרטי חשבונית (אופציונלי)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"מספר חשבונית",value:i?.invoiceNumber||"",onChange:t=>h(s=>({...s,invoiceNumber:t.target.value})),className:"input-class"}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"קובץ חשבונית (PDF)"}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:t=>ke(t,"invoice"),className:"file-input-class"}),i?.invoicePdfFile&&!xe&&e.jsxs("p",{className:"text-xs mt-1",children:["קובץ נוכחי: ",i.invoicePdfFile.name]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>R(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:Ze,className:"btn-primary",children:"שמור"})]})]})}),e.jsx(V,{isOpen:ze,onClose:()=>ue(!1),title:"פרטי הצעת מחיר",children:p&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"בניין:"})," ",p.projectName]}),p.subProjectName&&e.jsxs("p",{children:[e.jsx("strong",{children:"פרויקט משנה:"})," ",p.subProjectName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"שם הצעה:"})," ",p.quotationName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ספק:"})," ",p.supplierName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"תאריך:"})," ",ie(p.date)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"מחיר:"})," ₪",p.price.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"מספר הצעה:"})," ",p.quotationNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"תחום:"})," ",p.group]}),e.jsxs("p",{children:[e.jsx("strong",{children:"סטטוס:"})," ",e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${K[p.status].bg} ${K[p.status].text}`,children:p.status})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("button",{onClick:()=>{const t=p.pdfFile.url||p.pdfFile.dataUrl;t&&(pe({name:p.pdfFile.name,dataUrl:t}),W(!0))},className:"text-sky-600 hover:underline flex items-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),"הצג קובץ הצעת מחיר"]})}),p.invoicePdfFile&&e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"מספר חשבונית:"})," ",p.invoiceNumber||"-"]}),e.jsxs("button",{onClick:()=>{const t=p.invoicePdfFile?.url||p.invoicePdfFile?.dataUrl;t&&(pe({name:p.invoicePdfFile.name,dataUrl:t}),W(!0))},className:"text-sky-600 hover:underline flex items-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),"הצג קובץ חשבונית"]})]})]})}),e.jsx(V,{isOpen:_e,onClose:()=>W(!1),title:U?.name||"",size:"xl",children:U?.dataUrl&&e.jsx("iframe",{src:U.dataUrl,className:"w-full h-[75vh]",title:U.name})}),e.jsx(V,{isOpen:Ge,onClose:()=>z(!1),title:"בחירת הצעות מחיר להפקת PDF",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-2 bg-slate-50 rounded-md border",children:[e.jsx(ce,{title:"בניינים",options:se,selected:f.buildings,onToggle:t=>le("buildings",t),onToggleAll:()=>re("buildings",se)}),e.jsx(ce,{title:"שנים",options:ee,selected:f.years,onToggle:t=>le("years",t),onToggleAll:()=>re("years",ee)}),e.jsx(ce,{title:"תחומים",options:te,selected:f.groups,onToggle:t=>le("groups",t),onToggleAll:()=>re("groups",te)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>z(!1),className:"btn-secondary",children:"ביטול"}),e.jsxs("button",{onClick:it,disabled:ae.length===0,className:"btn-primary",children:["הפק PDF (",ae.length,")"]})]})]})}),e.jsx(V,{isOpen:We,onClose:()=>X(!1),title:"יבוא הצעות מחיר (AI)",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:"העלה קובץ PDF או CSV. לקבלת התוצאות הטובות ביותר, שמור את קובץ ה-Excel שלך כ-CSV (UTF-8)."}),e.jsx("input",{type:"file",onChange:Fe,accept:"application/pdf,text/csv,.csv",className:"file-input-class w-full"})]})}),e.jsx("style",{children:`
                .input-class { display: block; width: 100%; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.5rem 0.75rem; }
                .file-input-class { display: block; width: 100%; text-sm text-slate-500 file:mr-4 file:rtl:ml-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-sky-50 file:text-sky-700 hover:file:bg-sky-100 border border-slate-300 rounded-lg}
                .label-class { display: block; text-align: right; margin-bottom: 0.25rem; font-size: 0.8rem; font-weight: 500; color: #475569; }
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
                .form-checkbox { border-radius: 0.25rem; border-color: #94a3b8; color: #0284c7; }
                .form-checkbox:focus { ring-color: #38bdf8; }
            `})]})};export{Ot as default};
