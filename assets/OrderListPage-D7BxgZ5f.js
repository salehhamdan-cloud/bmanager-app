import{h as O,u as T,r as n,j as e,a as q,P as Q,ad as k,p as z,e as A}from"./index-BU7E-q7q.js";import{o as F}from"./imageService-tma56vZK.js";const $=()=>{const{settings:C,updateSettings:c,isLoading:L}=O(),{addToast:a}=T(),[m,g]=n.useState(""),[x,f]=n.useState(1),[u,b]=n.useState(null),[h,p]=n.useState(null),[o,j]=n.useState(""),[y,N]=n.useState(1),[d,w]=n.useState(null),r=C.inventoryOrderList||[],v=async(t,s)=>{const i=t.target.files?.[0];if(i)try{const l=await F(i,200,200),I={name:l.name,mimeType:l.mimeType,dataUrl:l.dataUrl};s==="new"?b(I):w(I)}catch{a("שגיאה בעיבוד התמונה","error")}finally{t.target.value=""}},S=async()=>{if(!m.trim()){a("יש להזין שם פריט","warning");return}const t={id:A(),name:m.trim(),quantity:x,photo:u||void 0};try{await c({inventoryOrderList:[...r,t]}),g(""),f(1),b(null),a("הפריט נוסף לרשימה","success")}catch{a("שגיאה בהוספת פריט","error")}},P=async t=>{const s=r.find(i=>i.id===t);if(s&&window.confirm(`האם לסמן את '${s.name}' כמוזמן? הפריט יוסר מהרשימה.`)){const i=r.filter(l=>l.id!==t);try{await c({inventoryOrderList:i}),a("הפריט סומן כמוזמן והוסר","success")}catch{a("שגיאה בסימון הפריט","error")}}},U=t=>{p(t.id),j(t.name),N(t.quantity),w(t.photo||null)},E=async()=>{if(!h||!o.trim())return;const t=r.map(s=>s.id===h?{...s,name:o.trim(),quantity:y,photo:d||void 0}:s);try{await c({inventoryOrderList:t}),p(null),a("הפריט עודכן","success")}catch{a("שגיאה בעדכון הפריט","error")}};return L?e.jsx(q,{text:"טוען רשימת הזמנות..."}):e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"פריטים להזמנה"}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"הוסף פריט חדש"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:m,onChange:t=>g(t.target.value),placeholder:"שם הפריט",className:"input-class md:col-span-2"}),e.jsx("input",{type:"number",min:"1",value:x,onChange:t=>f(parseInt(t.target.value,10)||1),className:"input-class"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:t=>v(t,"new"),className:"file-input-class flex-grow"}),u&&e.jsx("img",{src:u.dataUrl,alt:"Preview",className:"w-12 h-12 object-cover rounded-md"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:S,className:"btn-primary flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"הוסף לרשימה"]})})]}),r.length===0?e.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:e.jsx("p",{className:"text-slate-500",children:"רשימת ההזמנות ריקה."})}):e.jsx("div",{className:"space-y-3",children:r.map(t=>e.jsx("div",{className:"bg-white p-3 rounded-lg shadow-sm border flex items-center gap-4",children:h===t.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 flex-shrink-0 bg-slate-200 rounded-md overflow-hidden",children:(d?.url||d?.dataUrl)&&e.jsx("img",{src:d.url||d.dataUrl,alt:o,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-grow grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:s=>j(s.target.value),className:"input-class sm:col-span-2"}),e.jsx("input",{type:"number",min:"1",value:y,onChange:s=>N(parseInt(s.target.value,10)||1),className:"input-class"}),e.jsx("input",{type:"file",accept:"image/*",onChange:s=>v(s,"edit"),className:"file-input-class sm:col-span-3"})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsx("button",{onClick:E,className:"p-2 text-green-600 hover:bg-green-100 rounded-full",children:e.jsx(k,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>p(null),className:"p-2 text-slate-500 hover:bg-slate-100 rounded-full",children:"×"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-12 h-12 flex-shrink-0 bg-slate-200 rounded-md overflow-hidden",children:(t.photo?.url||t.photo?.dataUrl)&&e.jsx("img",{src:t.photo.url||t.photo.dataUrl,alt:t.name,className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex-grow",children:e.jsx("p",{className:"font-semibold text-slate-800",children:t.name})}),e.jsx("span",{className:"text-lg font-bold text-sky-700 bg-sky-100 rounded-full px-3 py-1",children:t.quantity}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>U(t),className:"p-2 text-slate-500 hover:bg-slate-100 rounded-full",title:"ערוך פריט",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>P(t.id),className:"p-2 text-green-500 hover:bg-green-100 rounded-full",title:"סמן כמוזמן",children:e.jsx(k,{className:"w-5 h-5"})})]})]})},t.id))}),e.jsx("style",{children:`
                .input-class { display: block; width: 100%; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.5rem 0.75rem; }
                .file-input-class { display: block; width: 100%; text-sm text-slate-500 file:mr-4 file:rtl:ml-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-sky-50 file:text-sky-700 hover:file:bg-sky-100 border border-slate-300 rounded-lg}
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
            `})]})};export{$ as default};
