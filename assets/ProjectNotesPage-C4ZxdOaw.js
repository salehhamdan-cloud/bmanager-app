import{k as P,B as k,u as D,h as S,r as o,l as A,j as e,a as C,L as T,A as p,P as I,T as E,e as L,z as g}from"./index-BU7E-q7q.js";import{a as f}from"./dateFormatter-CUKId3Gl.js";import{r as O}from"./pdfService-Th-ePIZW.js";import{e as F}from"./exportUtils-Bak1EFUX.js";const _=()=>{const{projectId:c}=P(),m=k(),{addToast:r}=D(),{settings:x}=S(),[s,j]=o.useState(null),[w,h]=o.useState(!0),[d,u]=o.useState(""),i=o.useCallback(async()=>{if(c){h(!0);try{const t=await A(c);t?j(t):(r("בניין לא נמצא","error"),m("/"))}catch{r("שגיאה בטעינת הערות","error")}finally{h(!1)}}},[c,r,m]);o.useEffect(()=>{i()},[i]);const N=async()=>{if(!d.trim()||!s)return;const t={id:L(),content:d.trim(),author:x.authorName,createdAt:new Date().toISOString()},a={...s,notes:[...s.notes||[],t],updatedAt:new Date().toISOString()};try{await g(a),r("הערה נוספה בהצלחה","success"),u(""),i()}catch{r("שגיאה בשמירת ההערה","error")}},b=async t=>{if(!s||!window.confirm("האם למחוק הערה זו?"))return;const a={...s,notes:(s.notes||[]).filter(l=>l.id!==t),updatedAt:new Date().toISOString()};try{await g(a),r("ההערה נמחקה","success"),i()}catch{r("שגיאה במחיקת ההערה","error")}},n=s?.notes?.sort((t,a)=>new Date(a.createdAt).getTime()-new Date(t.createdAt).getTime())||[],y=()=>{if(!s||n.length===0){r("אין הערות לייצוא","warning");return}r("מכין PDF...","info"),O({settings:x,project:s,notes:n})},v=()=>{if(n.length===0){r("אין הערות לייצוא","warning");return}const t=n.map(a=>({תאריך:f(a.createdAt),תוכן:a.content,"נכתב על ידי":a.author}));F(t,`notes_${s?.name}`)};return w?e.jsx(C,{text:"טוען הערות..."}):e.jsxs("div",{className:"space-y-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("nav",{className:"text-sm mb-1",children:e.jsx(T,{to:`/project/${c}`,className:"text-sky-600 hover:underline",children:"חזרה לבניין"})}),e.jsxs("h1",{className:"text-2xl font-bold text-slate-800",children:["הערות ומידע: ",s?.name]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:y,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(p,{className:"w-4 h-4"}),"PDF"]}),e.jsxs("button",{onClick:v,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(p,{className:"w-4 h-4"}),"Excel"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md border space-y-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"הוסף הערה חדשה"}),e.jsx("textarea",{value:d,onChange:t=>u(t.target.value),rows:4,placeholder:"כתוב כאן מידע כללי, תזכורות או עדכונים...",className:"w-full border border-slate-300 rounded-md p-2 focus:ring-sky-500 focus:border-sky-500"}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:N,disabled:!d.trim(),className:"btn-primary flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"שמור הערה"]})})]}),n.length===0?e.jsx("div",{className:"text-center p-10 bg-white rounded-lg shadow border",children:e.jsx("p",{className:"text-slate-500",children:"לא נמצאו הערות. התחל על ידי הוספת הערה חדשה."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:n.map(t=>e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border flex items-start gap-3",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"text-slate-700 whitespace-pre-wrap",children:t.content}),e.jsx("div",{className:"text-xs text-slate-400 mt-3 pt-2 border-t flex justify-end items-center",children:e.jsxs("span",{children:[t.author," · ",f(t.createdAt)]})})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("button",{onClick:()=>b(t.id),className:"p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"מחק הערה",children:e.jsx(E,{className:"w-4 h-4"})})})]},t.id))}),e.jsx("style",{children:`
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
                `})]})};export{_ as default};
