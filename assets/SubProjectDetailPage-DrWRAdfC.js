import{k as qe,B as es,u as ss,h as ts,r as n,l as as,aC as ls,n as ns,aD as M,j as e,a as is,L as xe,A as he,aE as E,aF as ge,p as rs,T as je,b1 as os,M as j,aG as cs,aH as fe,aK as ds,aJ as us,e as ms,aI as ps,z as xs}from"./index-BU7E-q7q.js";import{C as f}from"./CollapsibleSection-BbrEhqCk.js";import{A as hs}from"./AddFileModal-BXvBU1vj.js";import{A as gs}from"./AddTodoModal-fZggYYCI.js";import{F as js,i as fs,E as bs}from"./FileItem-BXRhVERa.js";import{T as Ns}from"./TodoItem-BtyccVcW.js";import{I as vs}from"./ImageUploader-DcmZM9_9.js";import{A as ws}from"./AnnotationEditor-Brb4Zcq3.js";import{f as $}from"./dateFormatter-CUKId3Gl.js";import{t as ys}from"./pdfService-Th-ePIZW.js";import"./RecurrenceEditor-Bj-SDiXW.js";import"./shareUtils-BhFQGnPw.js";import"./imageService-tma56vZK.js";const Ss=x=>{switch(x){case"פעיל":return{bg:"bg-green-100",text:"text-green-800"};case"הושלם":return{bg:"bg-blue-100",text:"text-blue-800"};case"בהמתנה":return{bg:"bg-amber-100",text:"text-amber-800"};case"בוטל":return{bg:"bg-slate-100",text:"text-slate-600"};default:return{bg:"bg-gray-100",text:"text-gray-800"}}},H=({title:x,value:u,colorClass:v})=>e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm text-center border",children:[e.jsx("p",{className:`text-2xl font-bold ${v}`,children:u}),e.jsx("p",{className:"text-xs font-medium text-slate-500",children:x})]}),Qs=()=>{const{projectId:x,subProjectId:u}=qe(),v=es(),{addToast:i}=ss(),{settings:be}=ts(),[m,Ne]=n.useState(null),[a,ve]=n.useState(null),[w,we]=n.useState([]),[J,ye]=n.useState([]),[Se,P]=n.useState(!0),[Pe,X]=n.useState(!1),[Ce,Y]=n.useState(!1),[g,Z]=n.useState(null),[q,Q]=n.useState(null),[y,L]=n.useState(null),[Fe,V]=n.useState(""),[b,z]=n.useState(null),[ke,C]=n.useState(!1),[F,ee]=n.useState([]),[se,te]=n.useState(""),[R,k]=n.useState(null),[ae,_]=n.useState(""),[De,D]=n.useState(!1),[r,p]=n.useState(null),[B,le]=n.useState(null),[ne,ie]=n.useState(null),[Ae,re]=n.useState(!1),[o,Ie]=n.useState(null),[Oe,G]=n.useState(!1),[A,oe]=n.useState(null),S=n.useCallback(async()=>{if(!(!x||!u)){P(!0);try{const[s,t,l]=await Promise.all([as(x),ls(),ns()]);if(s){Ne(s),we(t.filter(d=>d.subProjectId===u)),ye(l);const c=s.subProjects?.find(d=>d.id===u);c?ve(c):(i("פרויקט לא נמצא","error"),v(`/project/${x}/sub-projects`))}else i("בניין לא נמצא","error"),v("/")}catch{i("שגיאה בטעינת פרטי הפרויקט","error")}finally{P(!1)}}},[x,u,i,v]);n.useEffect(()=>{S()},[S]);const I=n.useMemo(()=>w.filter(s=>s.subProjectId===u),[w,u]),Te=async()=>{if(!(!m||!a)){i("מכין PDF...","info");try{await ys({settings:be,project:m,subProject:a,quotations:I})}catch(s){i("שגיאה ביצירת PDF","error"),console.error("PDF generation failed:",s)}}},O=n.useMemo(()=>{if(!w||!u)return 0;const s=[M.APPROVED,M.WORK_COMPLETED,M.INVOICE_PAID];return w.filter(t=>t.subProjectId===u&&s.includes(t.status)).reduce((t,l)=>t+(l.price||0),0)},[w,u]),h=async s=>{if(!m)return;const t={...m,subProjects:(m.subProjects||[]).map(l=>l.id===s.id?s:l),updatedAt:new Date().toISOString()};try{await xs(t),S()}catch{i("שגיאה בעדכון הפרויקט","error")}},Ue=async s=>{if(!a)return;const t={...a,files:[...a.files||[],...s]};await h(t),i(`${s.length} ${s.length>1?"קבצים נוספו":"קובץ נוסף"}`,"success")},Me=async s=>{if(!a||!window.confirm("האם למחוק קובץ זה?"))return;const t={...a,files:a.files.filter(l=>l.id!==s)};await h(t),i("הקובץ נמחק","success")},Ee=s=>{Q(s)},$e=async s=>{if(!a)return;const t={...a,files:a.files.map(l=>l.id===s.id?s:l)};await h(t),i("פרטי הקובץ עודכנו","success"),Q(null)},Qe=s=>{L(s);const t=s.originalUrl||s.originalDataUrl||s.url||s.dataUrl;if(!t){i("שגיאה בטעינת הקובץ לעריכה.","error");return}V(t)},Le=async s=>{if(!y||!a)return;const t=a.files.find(d=>d.id===y.id);if(!t)return;const l={...t,dataUrl:s.annotatedDataUrl,annotationData:s.annotationData,originalDataUrl:t.originalDataUrl||t.dataUrl,originalUrl:t.originalUrl||t.url,originalStoragePath:t.originalStoragePath||t.storagePath,url:void 0,storagePath:void 0},c={...a,files:a.files.map(d=>d.id===l.id?l:d)};await h(c),i("הערות תמונה נשמרו בהצלחה!","success"),L(null),V("")},Ve=async s=>{if(!a)return;const t={...a,rejects:[...a.rejects||[],s]};await h(t),i("משימה נוספה","success")},ze=async s=>{if(!a)return;const t={...a,rejects:(a.rejects||[]).map(l=>l.id===s?{...l,isCompleted:!l.isCompleted}:l)};await h(t)},Re=async s=>{if(!a||!window.confirm("האם למחוק משימה זו?"))return;const t={...a,rejects:(a.rejects||[]).filter(l=>l.id!==s)};await h(t),i("המשימה נמחקה","success")},_e=async s=>{if(!a||!window.confirm("האם אתה בטוח שברצונך למחוק תמונה זו?"))return;const t={...a,photos:a.photos.filter(l=>l.id!==s)};await h(t),i("התמונה נמחקה","success")},Be=async()=>{if(!a||F.length===0){i("יש להוסיף לפחות תמונה אחת","warning");return}const s=F.map(l=>({...l,folder:se.trim()||void 0})),t={...a,photos:[...a.photos||[],...s]};await h(t),i(`${F.length} תמונות נוספו בהצלחה`,"success"),C(!1),ee([]),te("")},Ge=s=>{k(s),_(s.folder||"")},We=async()=>{if(!R||!a)return;const s=a.photos.map(l=>l.id===R.id?{...l,folder:ae.trim()||void 0}:l),t={...a,photos:s};await h(t),i("התמונה הועברה","success"),k(null),_("")},T=n.useMemo(()=>(Array.isArray(a?.photos)?a.photos:[]).reduce((t,l)=>{const c=l.folder||"ללא תיקייה";return t[c]||(t[c]=[]),t[c].push(l),t},{}),[a?.photos]),W=n.useMemo(()=>(Array.isArray(a?.files)?a.files:[]).reduce((t,l)=>{const c=l.group||"כללי";return t[c]||(t[c]=[]),t[c].push(l),t},{}),[a?.files]),ce=(s=null)=>{p(s?{...s}:{date:new Date().toISOString().split("T")[0],status:M.PENDING,projectId:m?.id,projectName:m?.name,subProjectId:a?.id,subProjectName:a?.name}),le(null),ie(null),D(!0)},Ke=async s=>{if(window.confirm("האם למחוק הצעת מחיר זו?"))try{await ds(s),i("הצעת המחיר נמחקה","success"),S()}catch{i("שגיאה במחיקת הצעת המחיר","error")}},de=(s,t)=>{const l=s.target.files?.[0];if(l){if(l.type!=="application/pdf"){i("יש לבחור קובץ PDF בלבד","warning"),s.target.value="";return}t==="quotation"?le(l):ie(l)}},He=async()=>{if(!r||!r.supplierName||!r.quotationName||!r.projectName||!r.group||r.price===void 0){i("נא למלא את כל שדות החובה (*)","warning");return}if(!r.id&&!B){i("יש לצרף קובץ PDF של הצעת המחיר","warning");return}P(!0);try{const s=async d=>d?new Promise((Xe,Ye)=>{const K=new FileReader;K.onload=Ze=>Xe({name:d.name,dataUrl:Ze.target?.result,mimeType:d.type}),K.onerror=Ye,K.readAsDataURL(d)}):null,[t,l]=await Promise.all([s(B),s(ne)]);let c={...r};t&&(c.pdfFile=t),l&&(c.invoicePdfFile=l),r.id?(c.updatedAt=new Date().toISOString(),await us(c),i("הצעת המחיר עודכנה","success")):(c.id=ms(),c.createdAt=new Date().toISOString(),c.updatedAt=new Date().toISOString(),await ps(c),i("הצעת מחיר חדשה נוספה","success")),D(!1),p(null),S()}catch{i("שגיאה בשמירת הצעת המחיר","error")}finally{P(!1)}},Je=[...new Set(J.map(s=>s.group))];if(Se||!m||!a)return e.jsx(is,{text:"טוען פרטי פרויקט..."});const ue=Ss(a.status);a.rejects;const N=a.budget||0,me=N-O,U=N>0?O/N*100:0,pe=a.coverPhoto?.url||a.coverPhoto?.dataUrl;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("nav",{className:"text-sm",children:[e.jsx(xe,{to:`/project/${x}`,className:"text-sky-600 hover:underline",children:m.name}),e.jsx("span",{className:"text-slate-500 mx-2",children:"/"}),e.jsx(xe,{to:`/project/${x}/sub-projects`,className:"text-sky-600 hover:underline",children:"פרויקטים"})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-lg border",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[pe?e.jsx("img",{src:pe,alt:a.name,className:"w-full md:w-1/3 h-64 object-cover rounded-md shadow"}):e.jsx("div",{className:"w-full md:w-1/3 h-64 bg-slate-100 rounded-md flex items-center justify-center text-slate-400",children:"אין תמונת נושא"}),e.jsxs("div",{className:"flex-grow space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-semibold px-3 py-1 rounded-full whitespace-nowrap ${ue.bg} ${ue.text}`,children:a.status}),e.jsx("button",{onClick:Te,className:"btn-secondary flex items-center gap-2 text-sm p-2",children:e.jsx(he,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-slate-600",children:a.description}),e.jsxs("div",{className:"text-sm text-slate-600 grid grid-cols-2 gap-2 pt-2 border-t",children:[e.jsxs("span",{children:[e.jsx("strong",{children:"תחילת עבודה:"})," ",a.workStartDate?$(a.workStartDate):"לא צוין"]}),e.jsxs("span",{children:[e.jsx("strong",{children:"סיום עבודה:"})," ",a.workEndDate?$(a.workEndDate):"לא צוין"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2 text-slate-700",children:"קבלנים"}),e.jsx("ul",{className:"space-y-1 text-sm",children:(a.contractors||[]).map(s=>e.jsxs("li",{className:"p-2 bg-slate-50 rounded",children:[s.name," - ",s.phone]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2 text-slate-700",children:"מפקח"}),a.checker&&e.jsxs("div",{className:"text-sm p-2 bg-slate-50 rounded",children:[a.checker.name," - ",a.checker.phone]})]})]})]})]})}),e.jsxs(f,{title:"תקציב",defaultOpen:!0,children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center mb-4",children:[e.jsx(H,{title:"תקציב",value:`₪${N.toLocaleString()}`,colorClass:"text-slate-800"}),e.jsx(H,{title:"הוצאות (מאושר)",value:`₪${O.toLocaleString()}`,colorClass:"text-blue-600"}),e.jsx(H,{title:"יתרה",value:`₪${me.toLocaleString()}`,colorClass:me<0?"text-red-600":"text-green-600"})]}),N>0&&e.jsxs("div",{className:"w-full bg-slate-200 rounded-full h-4 relative mb-4",children:[e.jsx("div",{className:`h-4 rounded-full transition-all duration-500 ${U>100?"bg-red-500":"bg-blue-600"}`,style:{width:`${Math.min(U,100)}%`},title:`הוצאות: ${U.toFixed(1)}%`}),U>100&&e.jsxs("div",{className:"absolute -top-5 right-0 text-xs font-bold text-red-600",children:["חריגה של ₪",(O-N).toLocaleString()]})]})]}),e.jsx(f,{title:"הצעות מחיר",count:I.length,actionText:"הוסף הצעה",onActionClick:()=>ce(),children:e.jsx("div",{className:"space-y-3",children:I.length>0?I.map(s=>e.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-sm border flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-bold text-slate-800",children:s.quotationName}),e.jsxs("p",{className:"text-sm text-slate-500",children:[s.supplierName," • ",s.subProjectName?`${s.subProjectName} • `:""," ",$(s.date)]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-lg font-bold text-sky-700",children:["₪",s.price.toLocaleString()]}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full ${E[s.status].bg} ${E[s.status].text}`,children:s.status})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{Ie(s),re(!0)},className:"p-2 text-slate-500 hover:bg-slate-100 rounded-full",title:"הצג פרטים",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>ce(s),className:"p-2 text-slate-500 hover:bg-slate-100 rounded-full",title:"ערוך",children:e.jsx(rs,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Ke(s.id),className:"p-2 text-slate-500 hover:bg-red-100 rounded-full",title:"מחק",children:e.jsx(je,{className:"w-5 h-5"})})]})]},s.id)):e.jsx("p",{className:"text-center text-slate-500 py-4",children:"לא נוספו הצעות מחיר לפרויקט זה."})})}),e.jsx(f,{title:"רשימת ליקויים",count:a.rejects?.length||0,actionText:"הוסף משימה",onActionClick:()=>Y(!0),children:e.jsx("div",{className:"space-y-2",children:a.rejects?.map(s=>e.jsx(Ns,{todo:s,onToggle:()=>ze(s.id),onDelete:()=>Re(s.id)},s.id))})}),e.jsx(f,{title:"תמונות",count:a.photos.length,actionText:"הוסף תמונות",onActionClick:()=>C(!0),children:Object.keys(T).map(s=>e.jsx(f,{title:e.jsx("h4",{className:"text-md font-semibold",children:s}),count:T[s].length,children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:T[s].map(t=>e.jsxs("div",{className:"relative group rounded-md overflow-hidden shadow-sm border",children:[e.jsx("img",{src:t.url||t.dataUrl,alt:t.name,className:"w-full h-32 object-cover cursor-pointer",onClick:()=>z(t)}),e.jsxs("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>z(t),className:"p-2 bg-white/20 text-white rounded-full hover:bg-white/40",title:"הצג בגדול",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx("a",{href:t.url||t.dataUrl,download:t.name,className:"p-2 bg-white/20 text-white rounded-full hover:bg-white/40",title:"הורד",children:e.jsx(he,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>Ge(t),className:"p-2 bg-white/20 text-white rounded-full hover:bg-white/40",title:"העבר תיקייה",children:e.jsx(os,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>_e(t.id),className:"p-2 bg-red-500/50 text-white rounded-full hover:bg-red-500/80",title:"מחק",children:e.jsx(je,{className:"w-5 h-5"})})]})]},t.id))})},s))}),e.jsx(f,{title:"קבצים",count:a.files.length,actionText:"הוסף קובץ",onActionClick:()=>X(!0),children:Object.keys(W).map(s=>e.jsx(f,{title:e.jsx("h4",{className:"text-md font-semibold",children:s}),count:W[s].length,children:e.jsx("div",{className:"space-y-2",children:W[s].map(t=>e.jsx(js,{file:t,onDelete:()=>Me(t.id),onView:fs(t.mimeType)?()=>Z(t):void 0,onEdit:()=>Ee(t),onAnnotate:t.mimeType.startsWith("image/")?()=>Qe(t):void 0},t.id))})},s))}),e.jsx(hs,{isOpen:Pe,onClose:()=>X(!1),onSave:Ue,hideDateFields:!0}),e.jsx(gs,{isOpen:Ce,onClose:()=>Y(!1),onSave:Ve,projects:[m]}),e.jsx(j,{isOpen:!!g,onClose:()=>Z(null),title:`תצוגה מקדימה: ${g?.name}`,size:"xl",children:g&&(g.url||g.dataUrl)&&e.jsx("iframe",{src:g.url||g.dataUrl,className:"w-full h-[75vh] border-0"})}),e.jsx(j,{isOpen:ke,onClose:()=>C(!1),title:"הוספת תמונות לפרויקט",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:se,onChange:s=>te(s.target.value),placeholder:"שם תיקיית תמונות (אופציונלי)",className:"input-class w-full"}),e.jsx(vs,{images:F,onImagesChange:ee,maxImages:20}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>C(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:Be,className:"btn-primary",children:"שמור"})]})]})}),e.jsx(j,{isOpen:!!b,onClose:()=>z(null),title:b?.name||"תצוגת תמונה",size:"xl",children:b&&e.jsx("img",{src:b.url||b.dataUrl,alt:b.name||"",className:"max-w-full max-h-[80vh] object-contain mx-auto"})}),e.jsx(bs,{isOpen:!!q,onClose:()=>Q(null),onSave:$e,file:q,hideDateFields:!0}),y&&e.jsx(ws,{isOpen:!!y,onClose:()=>{L(null),V("")},onSave:Le,imageSrc:Fe,initialAnnotationData:y?.annotationData||"[]"}),e.jsx(j,{isOpen:!!R,onClose:()=>k(null),title:"העברת תמונה לתיקייה",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:ae,onChange:s=>_(s.target.value),placeholder:"שם תיקייה חדשה או קיימת",className:"input-class w-full",list:"folder-suggestions"}),e.jsx("datalist",{id:"folder-suggestions",children:Object.keys(T).map(s=>e.jsx("option",{value:s},s))}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>k(null),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:We,className:"btn-primary",children:"העבר"})]})]})}),e.jsx(j,{isOpen:De,onClose:()=>D(!1),title:r?.id?"עריכת הצעת מחיר":"הוספת הצעת מחיר",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"בניין*"}),e.jsx("input",{value:m.name,className:"input-class w-full bg-slate-100",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"פרויקט משנה"}),e.jsx("input",{value:a.name,className:"input-class w-full bg-slate-100",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"תאריך*"}),e.jsx("input",{type:"date",value:r?.date?.split("T")[0]||"",onChange:s=>p(t=>({...t,date:s.target.value})),className:"input-class w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"שם הספק*"}),e.jsx("input",{type:"text",list:"suppliers-list",value:r?.supplierName||"",onChange:s=>p(t=>({...t,supplierName:s.target.value})),className:"input-class w-full"}),e.jsx("datalist",{id:"suppliers-list",children:[...new Set(J.map(s=>s.name))].map(s=>e.jsx("option",{value:s},s))})]})]}),e.jsx("input",{type:"text",placeholder:"שם/תיאור הצעת המחיר*",value:r?.quotationName||"",onChange:s=>p(t=>({...t,quotationName:s.target.value})),className:"input-class w-full"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"מספר הצעה",value:r?.quotationNumber||"",onChange:s=>p(t=>({...t,quotationNumber:s.target.value})),className:"input-class"}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"תחום*"}),e.jsx("input",{type:"text",list:"groups-list",value:r?.group||"",onChange:s=>p(t=>({...t,group:s.target.value})),className:"input-class w-full"}),e.jsx("datalist",{id:"groups-list",children:Je.map(s=>e.jsx("option",{value:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"מחיר (₪)*"}),e.jsx("input",{type:"number",step:"0.01",value:r?.price??"",onChange:s=>p(t=>({...t,price:parseFloat(s.target.value)})),className:"input-class"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"סטטוס"}),e.jsx("select",{value:r?.status||"",onChange:s=>p(t=>({...t,status:s.target.value})),className:"input-class w-full",children:cs.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"קובץ הצעת מחיר (PDF)*"}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:s=>de(s,"quotation"),className:"file-input-class"}),r?.pdfFile&&!B&&e.jsxs("p",{className:"text-xs mt-1",children:["קובץ נוכחי: ",r.pdfFile.name]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h3",{className:"text-md font-medium text-slate-800 mb-2",children:"פרטי חשבונית (אופציונלי)"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",placeholder:"מספר חשבונית",value:r?.invoiceNumber||"",onChange:s=>p(t=>({...t,invoiceNumber:s.target.value})),className:"input-class"}),e.jsxs("div",{children:[e.jsx("label",{className:"label-class",children:"קובץ חשבונית (PDF)"}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:s=>de(s,"invoice"),className:"file-input-class"}),r?.invoicePdfFile&&!ne&&e.jsxs("p",{className:"text-xs mt-1",children:["קובץ נוכחי: ",r.invoicePdfFile.name]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{onClick:()=>D(!1),className:"btn-secondary",children:"ביטול"}),e.jsx("button",{onClick:He,className:"btn-primary",children:"שמור"})]})]})}),e.jsx(j,{isOpen:Ae,onClose:()=>re(!1),title:"פרטי הצעת מחיר",children:o&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"בניין:"})," ",o.projectName]}),o.subProjectName&&e.jsxs("p",{children:[e.jsx("strong",{children:"פרויקט משנה:"})," ",o.subProjectName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"שם הצעה:"})," ",o.quotationName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"ספק:"})," ",o.supplierName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"תאריך:"})," ",$(o.date)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"מחיר:"})," ₪",o.price.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"מספר הצעה:"})," ",o.quotationNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"תחום:"})," ",o.group]}),e.jsxs("p",{children:[e.jsx("strong",{children:"סטטוס:"})," ",e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${E[o.status].bg} ${E[o.status].text}`,children:o.status})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("button",{onClick:()=>{const s=o.pdfFile.url||o.pdfFile.dataUrl;s&&(oe({name:o.pdfFile.name,dataUrl:s}),G(!0))},className:"text-sky-600 hover:underline flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),"הצג קובץ הצעת מחיר"]})}),o.invoicePdfFile&&e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"מספר חשבונית:"})," ",o.invoiceNumber||"-"]}),e.jsxs("button",{onClick:()=>{const s=o.invoicePdfFile?.url||o.invoicePdfFile?.dataUrl;s&&(oe({name:o.invoicePdfFile.name,dataUrl:s}),G(!0))},className:"text-sky-600 hover:underline flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),"הצג קובץ חשבונית"]})]})]})}),e.jsx(j,{isOpen:Oe,onClose:()=>G(!1),title:A?.name||"",size:"xl",children:A?.dataUrl&&e.jsx("iframe",{src:A.dataUrl,className:"w-full h-[75vh]",title:A.name})}),e.jsx("style",{children:`
                .input-class { display: block; width: 100%; border: 1px solid #cbd5e1; border-radius: 0.375rem; padding: 0.5rem 0.75rem; }
                .file-input-class { display: block; width: 100%; text-sm text-slate-500 file:mr-4 file:rtl:ml-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-sky-50 file:text-sky-700 hover:file:bg-sky-100 border border-slate-300 rounded-lg}
                .label-class { display: block; text-align: right; margin-bottom: 0.25rem; font-size: 0.8rem; font-weight: 500; color: #475569; }
                .btn-primary { padding: 0.5rem 1rem; background-color: #0284c7; color: white; border-radius: 0.375rem; font-weight: 500; }
                .btn-secondary { padding: 0.5rem 1rem; background-color: #f1f5f9; color: #334155; border: 1px solid #cbd5e1; border-radius: 0.375rem; font-weight: 500; }
            `})]})};export{Qs as default};
